<!DOCTYPE html>
<html lang="tr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NVO LINK | Professional SaaS Link Gateway</title>
    
    <meta name="description" content="NVO LINK - Professional Social Unlock Gateway">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --accent: #06b6d4;
            --bg-dark: #0b0f1a;
            --card-dark: #151b2c;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-dark);
            color: #f8fafc;
            -webkit-tap-highlight-color: transparent;
        }

        .saas-gradient {
            background: linear-gradient(135deg, var(--primary), var(--accent));
        }

        .glass-panel {
            background: rgba(21, 27, 44, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .task-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .task-card.active {
            border-left: 4px solid var(--accent);
            background: rgba(6, 182, 212, 0.05);
        }

        /* SaaS Loader */
        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .btn-boost:active { transform: scale(0.96); }
    </style>
</head>
<body class="antialiased overflow-x-hidden">

    <nav class="sticky top-0 z-50 glass-panel px-4 py-3 flex justify-between items-center border-b border-white/5">
        <div class="flex items-center gap-2">
            <div class="w-9 h-9 saas-gradient rounded-xl flex items-center justify-center shadow-lg shadow-indigo-500/20">
                <i class="fa-solid fa-link text-white text-sm"></i>
            </div>
            <span class="font-extrabold text-lg tracking-tight">NVO<span class="text-indigo-400">LINK</span></span>
        </div>
        <div id="navActions" class="flex gap-2">
            </div>
    </nav>

    <main class="max-w-xl mx-auto px-4 pt-6 pb-24">
        
        <section id="adminDashboard" class="hidden space-y-6">
            <div class="grid grid-cols-2 gap-4">
                <div class="glass-panel p-4 rounded-2xl">
                    <p class="text-[10px] text-slate-400 font-bold uppercase tracking-wider">Total Links</p>
                    <div class="flex items-baseline gap-2">
                        <h2 id="statTotalLinks" class="text-2xl font-black">0</h2>
                        <span class="text-green-400 text-[10px] font-bold">+12%</span>
                    </div>
                </div>
                <div class="glass-panel p-4 rounded-2xl">
                    <p class="text-[10px] text-slate-400 font-bold uppercase tracking-wider">Global Views</p>
                    <h2 id="statTotalViews" class="text-2xl font-black">0</h2>
                </div>
            </div>

            <div class="glass-panel p-6 rounded-[2.5rem] relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10">
                    <i class="fa-solid fa-rocket text-4xl"></i>
                </div>
                <h3 class="font-bold text-lg mb-4">Create Campaign</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="text-[10px] font-bold text-slate-500 ml-2 mb-1 block">CAMPAIGN TITLE</label>
                        <input type="text" id="lTitle" placeholder="e.g. My Secret Mod Menu" class="w-full bg-slate-900 border border-white/10 rounded-xl p-3 text-sm focus:border-indigo-500 outline-none">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-500 ml-2 mb-1 block">TARGET DESTINATION</label>
                        <input type="text" id="lTarget" placeholder="https://..." class="w-full bg-slate-900 border border-white/10 rounded-xl p-3 text-sm focus:border-indigo-500 outline-none">
                    </div>

                    <div class="bg-black/20 p-4 rounded-2xl border border-white/5">
                        <p class="text-[10px] font-bold text-slate-500 mb-3">SOCIAL TASKS (REQUIRED)</p>
                        <div id="taskBuilderList" class="space-y-2 mb-4"></div>
                        <div class="flex gap-2">
                            <select id="taskType" class="bg-slate-800 border-none rounded-lg text-[10px] px-2 text-white outline-none">
                                <option value="youtube">YouTube</option>
                                <option value="discord">Discord</option>
                                <option value="instagram">Instagram</option>
                                <option value="other">Link</option>
                            </select>
                            <input type="text" id="tName" placeholder="Task Name" class="flex-1 bg-slate-800 border-none rounded-lg p-2 text-[10px] text-white">
                            <input type="text" id="tLink" placeholder="URL" class="flex-1 bg-slate-800 border-none rounded-lg p-2 text-[10px] text-white">
                            <button onclick="addTaskToBuilder()" class="w-10 h-10 saas-gradient rounded-lg flex items-center justify-center text-white"><i class="fa-solid fa-plus"></i></button>
                        </div>
                    </div>

                    <button onclick="publishCampaign()" class="w-full py-4 saas-gradient rounded-2xl font-extrabold text-white shadow-xl shadow-indigo-500/20 btn-boost">
                        GENERATE SMART LINK
                    </button>
                </div>
            </div>

            <div id="campaignList" class="space-y-3">
                </div>
        </section>

        <section id="visitorGateway" class="hidden text-center pt-8">
            <div class="inline-flex p-1 rounded-3xl bg-slate-800/50 border border-white/5 mb-6">
                <div class="px-4 py-1 rounded-2xl bg-indigo-500 text-[10px] font-bold text-white uppercase tracking-tighter">Verified Link</div>
            </div>
            
            <h1 id="vTitle" class="text-3xl font-black mb-2 tracking-tight">Campaign Loading...</h1>
            <p class="text-slate-400 text-sm mb-10 px-8">Complete the following steps to unlock your destination.</p>

            <div id="vTaskList" class="space-y-3 text-left">
                <div class="glass-panel p-5 rounded-2xl shimmer h-16"></div>
                <div class="glass-panel p-5 rounded-2xl shimmer h-16"></div>
            </div>

            <button id="vUnlockBtn" disabled class="w-full mt-10 py-5 rounded-[2rem] bg-slate-800 text-slate-500 font-black tracking-widest border border-white/5 opacity-50 flex items-center justify-center gap-3">
                <i class="fa-solid fa-lock"></i> STEPS INCOMPLETE
            </button>
        </section>

    </main>

    <div id="qrModal" class="fixed inset-0 z-[100] bg-black/95 hidden flex items-center justify-center p-6" onclick="this.classList.add('hidden')">
        <div class="glass-panel p-8 rounded-[3rem] text-center w-full max-w-xs" onclick="event.stopPropagation()">
            <h3 class="font-bold mb-4">Smart QR Code</h3>
            <img id="qrImage" src="" class="w-full rounded-2xl border-8 border-white mb-6">
            <button onclick="document.getElementById('qrModal').classList.add('hidden')" class="w-full py-3 bg-white/10 rounded-xl font-bold">Close</button>
        </div>
    </div>

    <div id="adminNav" class="hidden fixed bottom-6 left-1/2 -translate-x-1/2 glass-panel px-6 py-4 rounded-full flex items-center gap-8 shadow-2xl z-50">
        <button onclick="location.reload()" class="text-indigo-400"><i class="fa-solid fa-house-chimney text-lg"></i></button>
        <button onclick="alert('Insight Pro: Coming Soon')" class="text-slate-500"><i class="fa-solid fa-chart-line text-lg"></i></button>
        <button onclick="userLogout()" class="text-red-500/70"><i class="fa-solid fa-arrow-right-from-bracket text-lg"></i></button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, doc, getDoc, getDocs, deleteDoc, query, where, serverTimestamp, writeBatch, increment, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // CONFIG (Replace with your actual Firebase config)
        const firebaseConfig = {
            apiKey: "AIzaSyDc1sWTsgQC4yqZnEKP4GutuNWcUCZGhv0",
            authDomain: "nvo-link.firebaseapp.com",
            projectId: "nvo-link",
            storageBucket: "nvo-link.firebasestorage.app",
            messagingSenderId: "256153773846",
            appId: "1:256153773846:web:6d51174db82ccccf119237"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        let builderTasks = [];
        const params = new URLSearchParams(window.location.search);
        const campaignID = params.get('id');

        // --- AUTH LOGIC ---
        onAuthStateChanged(auth, (user) => {
            if (campaignID) {
                document.getElementById('visitorGateway').classList.remove('hidden');
                loadVisitorGateway();
            } else if (user) {
                document.getElementById('adminDashboard').classList.remove('hidden');
                document.getElementById('adminNav').classList.remove('hidden');
                document.getElementById('navActions').innerHTML = `<img src="${user.photoURL}" class="w-9 h-9 rounded-full ring-2 ring-indigo-500/20">`;
                loadAdminCampaigns(user.uid);
            } else {
                renderLoginScreen();
            }
        });

        function renderLoginScreen() {
            document.getElementById('adminDashboard').classList.remove('hidden');
            document.getElementById('adminDashboard').innerHTML = `
                <div class="text-center py-20">
                    <div class="w-20 h-20 saas-gradient rounded-[2rem] flex items-center justify-center mx-auto mb-6 shadow-2xl rotate-12">
                        <i class="fa-solid fa-lock text-3xl text-white"></i>
                    </div>
                    <h2 class="text-2xl font-extrabold mb-2">Grow Your Audience</h2>
                    <p class="text-slate-400 text-sm mb-8 px-10">The most professional way to lock your content and grow social accounts.</p>
                    <button id="googleLogin" class="w-full py-4 bg-white text-black font-black rounded-2xl flex items-center justify-center gap-3">
                        <img src="https://www.gstatic.com/images/branding/product/1x/gsa_512dp.png" class="w-5 h-5">
                        SIGN IN WITH GOOGLE
                    </button>
                </div>
            `;
            document.getElementById('googleLogin').onclick = () => signInWithPopup(auth, provider);
        }

        window.userLogout = () => signOut(auth).then(() => location.reload());

        // --- ADMIN: CAMPAIGN BUILDER ---
        window.addTaskToBuilder = () => {
            const type = document.getElementById('taskType').value;
            const name = document.getElementById('tName').value;
            const link = document.getElementById('tLink').value;
            
            if (name && link) {
                builderTasks.push({ type, name, link: link.includes('://') ? link : 'https://' + link });
                renderBuilderList();
                document.getElementById('tName').value = "";
                document.getElementById('tLink').value = "";
            }
        };

        function renderBuilderList() {
            const list = document.getElementById('taskBuilderList');
            list.innerHTML = builderTasks.map((t, i) => `
                <div class="flex items-center justify-between bg-slate-800/50 p-2 rounded-xl text-[10px] border border-white/5">
                    <span class="font-bold flex items-center gap-2">
                        <i class="fa-brands fa-${t.type === 'other' ? 'link' : t.type} text-indigo-400"></i> ${t.name}
                    </span>
                    <button onclick="builderTasks.splice(${i},1);renderBuilderList()" class="text-red-400"><i class="fa-solid fa-trash"></i></button>
                </div>
            `).join('');
        }

        window.publishCampaign = async () => {
            const title = document.getElementById('lTitle').value;
            const target = document.getElementById('lTarget').value;
            
            if (!title || !target) return alert("Fill all fields!");

            const docRef = await addDoc(collection(db, "links"), {
                title, 
                target: target.includes('://') ? target : 'https://' + target, 
                uid: auth.currentUser.uid, 
                views: 0,
                createdAt: serverTimestamp()
            });

            const batch = writeBatch(db);
            builderTasks.forEach((t, i) => {
                const tRef = doc(collection(db, "links", docRef.id, "tasks"));
                batch.set(tRef, { ...t, order: i });
            });
            await batch.commit();
            location.reload();
        };

        async function loadAdminCampaigns(uid) {
            const q = query(collection(db, "links"), where("uid", "==", uid));
            const snap = await getDocs(q);
            const list = document.getElementById('campaignList');
            let totalViews = 0;
            document.getElementById('statTotalLinks').innerText = snap.size;
            list.innerHTML = "";
            
            snap.forEach(d => {
                const data = d.data();
                totalViews += (data.views || 0);
                const shareUrl = window.location.origin + window.location.pathname + "?id=" + d.id;
                list.innerHTML += `
                    <div class="glass-panel p-4 rounded-2xl flex items-center justify-between group hover:border-indigo-500/50 transition">
                        <div class="overflow-hidden mr-3">
                            <h4 class="font-bold text-sm truncate">${data.title}</h4>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="text-[9px] text-slate-500 font-bold uppercase tracking-tighter"><i class="fa-solid fa-eye mr-1"></i> ${data.views || 0}</span>
                            </div>
                        </div>
                        <div class="flex gap-1">
                            <button onclick="showQR('${shareUrl}')" class="w-8 h-8 rounded-lg bg-white/5 text-slate-400 hover:text-indigo-400 transition"><i class="fa-solid fa-qrcode text-xs"></i></button>
                            <button onclick="navigator.clipboard.writeText('${shareUrl}');alert('Link Copied!')" class="w-8 h-8 rounded-lg bg-white/5 text-slate-400 hover:text-indigo-400 transition"><i class="fa-solid fa-copy text-xs"></i></button>
                            <button onclick="deleteCampaign('${d.id}')" class="w-8 h-8 rounded-lg bg-white/5 text-slate-400 hover:text-red-500 transition"><i class="fa-solid fa-trash text-xs"></i></button>
                        </div>
                    </div>
                `;
            });
            document.getElementById('statTotalViews').innerText = totalViews;
        }

        window.showQR = (url) => {
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(url)}&bgcolor=ffffff&color=000000`;
            document.getElementById('qrImage').src = qrUrl;
            document.getElementById('qrModal').classList.remove('hidden');
        };

        window.deleteCampaign = async (id) => {
            if(confirm("Delete this campaign?")) {
                await deleteDoc(doc(db, "links", id));
                location.reload();
            }
        };

        // --- VISITOR: GATEWAY LOGIC ---
        async function loadVisitorGateway() {
            const dRef = doc(db, "links", campaignID);
            const dSnap = await getDoc(dRef);
            
            if (!dSnap.exists()) {
                document.getElementById('visitorGateway').innerHTML = "<h1>Link Expired or Invalid</h1>";
                return;
            }

            // Analytics: Update View
            updateDoc(dRef, { views: increment(1) });

            document.getElementById('vTitle').innerText = dSnap.data().title;
            const tSnap = await getDocs(collection(db, "links", campaignID, "tasks"));
            const tasks = [];
            tSnap.forEach(t => tasks.push(t.data()));

            const list = document.getElementById('vTaskList');
            if (tasks.length === 0) return unlockNow(dSnap.data().target);

            list.innerHTML = tasks.map((t, i) => `
                <div id="vStep-${i}" class="task-card glass-panel p-5 rounded-2xl flex items-center justify-between border-l-4 ${i===0 ? 'active border-indigo-400' : 'opacity-30 pointer-events-none'}">
                    <div class="flex items-center gap-4">
                        <div id="vIcon-${i}" class="w-10 h-10 rounded-xl bg-slate-800 flex items-center justify-center text-indigo-400">
                            <i class="fa-brands fa-${t.type === 'other' ? 'link' : t.type} text-lg"></i>
                        </div>
                        <div>
                            <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">${t.type}</p>
                            <h4 class="font-bold text-sm text-white">${t.name}</h4>
                        </div>
                    </div>
                    <button id="vBtn-${i}" onclick="startVerification(${i}, '${t.link}', ${tasks.length}, '${dSnap.data().target}')" class="px-5 py-2 saas-gradient text-white text-[10px] font-black rounded-xl ${i===0?'':'hidden'}">GO</button>
                </div>
            `).join('');
        }

        window.startVerification = (i, url, total, target) => {
            window.open(url, '_blank');
            const btn = document.getElementById(`vBtn-${i}`);
            let timer = 10;
            
            const itv = setInterval(() => {
                btn.disabled = true;
                btn.innerText = `WAITING ${timer}S`;
                btn.classList.add('opacity-50', 'cursor-not-allowed');
                timer--;
                
                if (timer < 0) {
                    clearInterval(itv);
                    completeVerification(i, total, target);
                }
            }, 1000);
        };

        function completeVerification(i, total, target) {
            const card = document.getElementById(`vStep-${i}`);
            const icon = document.getElementById(`vIcon-${i}`);
            const btn = document.getElementById(`vBtn-${i}`);

            card.classList.remove('active', 'border-indigo-400');
            card.classList.add('border-green-500/50');
            icon.innerHTML = '<i class="fa-solid fa-check text-green-400"></i>';
            btn.remove();

            if (i + 1 < total) {
                const next = document.getElementById(`vStep-${i+1}`);
                next.classList.remove('opacity-30', 'pointer-events-none');
                next.classList.add('active', 'border-indigo-400');
                document.getElementById(`vBtn-${i+1}`).classList.remove('hidden');
            } else {
                unlockNow(target);
            }
        }

        function unlockNow(url) {
            confetti({ particleCount: 150, spread: 80, origin: { y: 0.7 }, colors: ['#6366f1', '#06b6d4', '#ffffff'] });
            const b = document.getElementById('vUnlockBtn');
            b.disabled = false;
            b.classList.remove('bg-slate-800', 'text-slate-500', 'opacity-50');
            b.classList.add('saas-gradient', 'text-white', 'opacity-100', 'animate-bounce', 'shadow-2xl', 'shadow-indigo-500/40');
            b.innerHTML = '<i class="fa-solid fa-cloud-arrow-down mr-2"></i> UNLOCK CONTENT';
            b.onclick = () => location.href = url;
        }

    </script>
</body>
</html>