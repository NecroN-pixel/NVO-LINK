<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NVO LINK v8.0 PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* PRO AYARLAR */
        :root { --primary: #6366f1; --bg-light: #f8fafc; --bg-dark: #0f172a; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Plus Jakarta Sans', sans-serif; }
        
        body { background: var(--bg-light); color: #1e293b; overflow-x: hidden; transition: 0.3s; }
        .dark body { background: var(--bg-dark); color: #f1f5f9; }

        /* SIDEBAR (YAN MENÃœ) */
        #sidebar { 
            position: fixed; top: 0; right: -100%; width: 280px; height: 100vh; 
            background: rgba(255,255,255,0.95); backdrop-filter: blur(15px); 
            z-index: 9999; box-shadow: -10px 0 30px rgba(0,0,0,0.1); 
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); padding: 30px; display: flex; flex-col; justify-content: space-between;
        }
        .dark #sidebar { background: rgba(15, 23, 42, 0.95); border-left: 1px solid rgba(255,255,255,0.05); }
        #sidebar.active { right: 0; }
        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 9998; opacity: 0; pointer-events: none; transition: 0.3s; }
        #overlay.active { opacity: 1; pointer-events: auto; }

        /* GÃœZEL GÃ–REV KARTLARI */
        .task-item { transition: all 0.3s ease; border: 1px solid transparent; }
        .task-item:hover { transform: translateY(-2px); }
        .task-done { border-color: #22c55e; background: rgba(34, 197, 94, 0.05); }
        .dark .task-done { background: rgba(34, 197, 94, 0.1); }

        /* LOADER */
        .loader { width: 48px; height: 48px; border: 5px solid #e2e8f0; border-bottom-color: var(--primary); border-radius: 50%; display: inline-block; box-sizing: border-box; animation: rotation 1s linear infinite; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* MODERN INPUT */
        input { background: transparent; border: 2px solid #cbd5e1; border-radius: 16px; padding: 16px; width: 100%; outline: none; transition: 0.2s; font-weight: 600; }
        input:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1); }
        .dark input { border-color: #334155; color: white; }
    </style>
    <script>
        tailwind.config = { darkMode: 'class', theme: { extend: { colors: { brand: '#6366f1' } } } }
    </script>
</head>
<body class="flex flex-col min-h-screen">

    <div id="overlay" onclick="toggleMenu()"></div>
    <div id="sidebar">
        <div>
            <div class="flex justify-between items-center mb-10">
                <h2 class="text-2xl font-black italic text-brand">MENU</h2>
                <button onclick="toggleMenu()" class="w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center"><i class="fa-solid fa-xmark text-lg"></i></button>
            </div>
            <nav class="space-y-2">
                <a href="#" onclick="location.reload()" class="block p-4 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 font-bold"><i class="fa-solid fa-house mr-3 text-brand"></i> Ana Sayfa</a>
                <button onclick="toggleDark()" class="w-full text-left p-4 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 font-bold"><i class="fa-solid fa-moon mr-3 text-brand"></i> Gece Modu</button>
                <div id="authLinks">
                    </div>
            </nav>
        </div>
        <div class="text-xs text-slate-400 text-center">
            <p>NVO LINK v8.0 PRO</p>
            <p class="opacity-50">Designed for Winners</p>
        </div>
    </div>

    <div id="updateModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 hidden px-4">
        <div class="bg-white dark:bg-slate-900 w-full max-w-sm rounded-[32px] p-8 text-center relative overflow-hidden">
            <div class="absolute top-0 w-full h-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 left-0"></div>
            <div class="w-16 h-16 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4 text-2xl">ðŸ”¥</div>
            <h2 class="text-2xl font-black mb-2">MEGA UPDATE v8.0</h2>
            <p class="text-slate-500 text-sm mb-6">Daha sade, daha hÄ±zlÄ± ve Ã§ok daha profesyonel.</p>
            <button onclick="closeUpdate()" class="w-full py-4 bg-brand text-white font-bold rounded-2xl">BAÅžLAYALIM</button>
        </div>
    </div>

    <header class="p-5 flex justify-between items-center sticky top-0 bg-white/80 dark:bg-slate-900/80 backdrop-blur-lg z-40 border-b dark:border-slate-800/50">
        <div class="flex items-center gap-2">
            <div class="w-10 h-10 bg-brand text-white rounded-xl flex items-center justify-center shadow-lg shadow-indigo-500/30">
                <i class="fa-solid fa-bolt text-xl"></i>
            </div>
            <div>
                <h1 class="font-black text-xl tracking-tighter leading-none">NVO</h1>
                <p class="text-[10px] font-bold text-slate-400 tracking-widest">LINK PRO</p>
            </div>
        </div>
        <button onclick="toggleMenu()" class="w-12 h-12 flex items-center justify-center rounded-2xl active:bg-slate-100 dark:active:bg-slate-800 transition">
            <i class="fa-solid fa-bars-staggered text-2xl text-slate-700 dark:text-white"></i>
        </button>
    </header>

    <main class="flex-1 w-full max-w-xl mx-auto p-4 md:p-6 relative">
        
        <div id="loading" class="absolute inset-0 flex items-center justify-center bg-transparent z-10">
            <span class="loader"></span>
        </div>

        <div id="adminPanel" class="hidden animate-[fadeIn_0.5s_ease-out]">
            <div class="bg-white dark:bg-slate-900 p-6 md:p-8 rounded-[32px] shadow-2xl shadow-slate-200/50 dark:shadow-none border border-slate-100 dark:border-slate-800">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="font-black text-xl">Yeni BaÄŸlantÄ±</h3>
                    <span class="bg-green-100 text-green-600 text-[10px] font-bold px-2 py-1 rounded">ACTIVE</span>
                </div>
                
                <div class="space-y-4">
                    <div class="group">
                        <label class="text-xs font-bold text-slate-400 ml-2 mb-1 block">DOSYA ADI</label>
                        <input type="text" id="lTitle" placeholder="Ã–rn: Minecraft Mod v2">
                    </div>
                    <div class="group">
                        <label class="text-xs font-bold text-slate-400 ml-2 mb-1 block">HEDEF LÄ°NK</label>
                        <input type="text" id="lTarget" placeholder="drive.google.com/...">
                    </div>

                    <div class="p-5 bg-slate-50 dark:bg-slate-800/50 rounded-2xl border-2 border-dashed border-slate-200 dark:border-slate-700">
                        <div id="localList" class="space-y-3 mb-4 empty:hidden"></div>
                        
                        <div class="grid grid-cols-[1fr_1fr_auto] gap-2 items-end">
                            <div>
                                <input type="text" id="tName" placeholder="GÃ¶rev AdÄ±" class="!text-sm !p-3">
                            </div>
                            <div>
                                <input type="text" id="tLink" placeholder="Link" class="!text-sm !p-3">
                            </div>
                            <button onclick="addLocalTask()" class="h-[50px] w-[50px] bg-slate-900 dark:bg-white text-white dark:text-slate-900 rounded-2xl flex items-center justify-center hover:scale-95 transition">
                                <i class="fa-solid fa-plus text-lg"></i>
                            </button>
                        </div>
                    </div>

                    <button onclick="publishLink()" class="w-full py-5 bg-brand text-white rounded-2xl font-black text-lg shadow-xl shadow-brand/30 hover:shadow-brand/50 hover:-translate-y-1 transition-all">
                        YAYINLA <i class="fa-solid fa-paper-plane ml-2"></i>
                    </button>
                </div>
            </div>

            <div class="mt-8 space-y-4 pb-20">
                <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest pl-4">Son Linklerim</h3>
                <div id="linkList" class="grid gap-3"></div>
            </div>
        </div>

        <div id="visitorPanel" class="hidden text-center py-8">
            <div class="inline-block p-1 rounded-[40px] bg-gradient-to-b from-slate-100 to-white dark:from-slate-800 dark:to-slate-900 shadow-2xl mb-8">
                <div class="w-32 h-32 bg-slate-50 dark:bg-slate-800 rounded-[36px] flex items-center justify-center text-5xl text-brand border-4 border-white dark:border-slate-700">
                    <i class="fa-brands fa-google-drive"></i>
                </div>
            </div>

            <h1 id="vTitle" class="text-3xl font-black mb-3 leading-tight">Dosya HazÄ±r</h1>
            <p class="text-slate-400 text-sm max-w-xs mx-auto mb-10">Dosyaya eriÅŸmek iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± hÄ±zlÄ±ca tamamla.</p>

            <div id="vTaskList" class="space-y-3 text-left max-w-md mx-auto">
                </div>

            <button id="vUnlock" disabled class="w-full max-w-md mt-10 py-5 rounded-2xl bg-slate-200 dark:bg-slate-800 text-slate-400 font-bold transition-all duration-500 scale-95 opacity-50">
                <i class="fa-solid fa-lock mr-2"></i> KÄ°LÄ°TLÄ°
            </button>
        </div>

    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, doc, getDoc, getDocs, deleteDoc, query, where, serverTimestamp, writeBatch } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDc1sWTsgQC4yqZnEKP4GutuNWcUCZGhv0",
            authDomain: "nvo-link.firebaseapp.com",
            projectId: "nvo-link",
            storageBucket: "nvo-link.firebasestorage.app",
            messagingSenderId: "256153773846",
            appId: "1:256153773846:web:6d51174db82ccccf119237"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        let tempTasks = [];
        const lid = new URLSearchParams(window.location.search).get('id');

        // --- UI FUNCTIONS ---
        window.toggleMenu = () => {
            const sb = document.getElementById('sidebar');
            const ov = document.getElementById('overlay');
            sb.classList.toggle('active');
            ov.classList.toggle('active');
        };

        window.toggleDark = () => {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
        };
        if(localStorage.theme === 'dark') document.documentElement.classList.add('dark');

        // GÃ¼ncelleme Notu (Smart)
        if(!lid && localStorage.getItem('v8_seen') !== 'true') {
            document.getElementById('updateModal').classList.remove('hidden');
        }
        window.closeUpdate = () => {
            localStorage.setItem('v8_seen', 'true');
            document.getElementById('updateModal').classList.add('hidden');
        };

        // --- AUTH LOGIC ---
        onAuthStateChanged(auth, user => {
            document.getElementById('loading').style.display = 'none';
            const authMenu = document.getElementById('authLinks');
            
            if(lid) {
                // ZiyaretÃ§i
                document.getElementById('visitorPanel').classList.remove('hidden');
                authMenu.innerHTML = `<button onclick="window.location.href='/'" class="block w-full text-left p-4 rounded-xl font-bold text-brand">Admin GiriÅŸi</button>`;
                loadVisitor();
            } else if(user) {
                // Admin
                document.getElementById('adminPanel').classList.remove('hidden');
                authMenu.innerHTML = `
                    <div class="flex items-center gap-3 p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl mb-2">
                        <img src="${user.photoURL}" class="w-8 h-8 rounded-full">
                        <span class="text-sm font-bold truncate">${user.displayName}</span>
                    </div>
                    <button onclick="logout()" class="block w-full text-left p-4 rounded-xl text-red-500 font-bold hover:bg-red-50">Ã‡Ä±kÄ±ÅŸ Yap</button>
                `;
                loadLinks(user.uid);
            } else {
                // GiriÅŸsiz
                document.getElementById('adminPanel').classList.remove('hidden'); // GiriÅŸ ekranÄ± admin panelin iÃ§inde gibi davranacak ama iÃ§erik gizli
                document.getElementById('adminPanel').innerHTML = `
                    <div class="text-center py-20">
                        <h2 class="text-3xl font-black mb-4">GiriÅŸ Yap</h2>
                        <p class="text-slate-400 mb-8">Linklerini yÃ¶netmek iÃ§in devam et.</p>
                        <button onclick="login()" class="py-4 px-8 bg-brand text-white rounded-2xl font-bold shadow-lg shadow-brand/40">GOOGLE Ä°LE GÄ°RÄ°Åž</button>
                    </div>
                `;
                authMenu.innerHTML = `<button onclick="login()" class="block w-full text-left p-4 rounded-xl font-bold text-brand">GiriÅŸ Yap</button>`;
            }
        });

        window.login = () => signInWithPopup(auth, provider);
        window.logout = () => signOut(auth).then(() => location.reload());

        // --- ADMIN FEATURES ---
        const safeUrl = (u) => u.startsWith('http') ? u : 'https://' + u;

        window.addLocalTask = () => {
            const n = document.getElementById('tName').value;
            const l = document.getElementById('tLink').value;
            if(n && l) {
                tempTasks.push({ name: n, link: safeUrl(l) });
                renderLocal();
                document.getElementById('tName').value = ""; document.getElementById('tLink').value = "";
            }
        };

        function renderLocal() {
            document.getElementById('localList').innerHTML = tempTasks.map((t, i) => `
                <div class="flex justify-between items-center bg-white dark:bg-slate-900 p-3 rounded-xl shadow-sm border dark:border-slate-700">
                    <span class="font-bold text-xs truncate flex-1">${t.name}</span>
                    <button onclick="removeTask(${i})" class="w-6 h-6 rounded-full bg-red-50 text-red-500 flex items-center justify-center"><i class="fa-solid fa-minus text-[10px]"></i></button>
                </div>
            `).join('');
        }
        window.removeTask = (i) => { tempTasks.splice(i, 1); renderLocal(); };

        window.publishLink = async () => {
            const t = document.getElementById('lTitle').value;
            const l = safeUrl(document.getElementById('lTarget').value);
            if(!t || !l) return alert("Eksik bilgi!");

            const docRef = await addDoc(collection(db, "links"), { 
                title: t, target: l, uid: auth.currentUser.uid, createdAt: serverTimestamp() 
            });
            
            const batch = writeBatch(db);
            tempTasks.forEach((task, i) => {
                const tRef = doc(collection(db, "links", docRef.id, "tasks"));
                batch.set(tRef, { ...task, order: i });
            });
            await batch.commit();
            location.reload();
        };

        async function loadLinks(uid) {
            const q = query(collection(db, "links"), where("uid", "==", uid));
            const snap = await getDocs(q);
            const list = document.getElementById('linkList');
            list.innerHTML = "";
            snap.forEach(d => {
                const url = location.origin + location.pathname + "?id=" + d.id;
                list.innerHTML += `
                    <div class="bg-white dark:bg-slate-900 p-5 rounded-2xl shadow-sm border dark:border-slate-800 flex items-center justify-between group hover:border-brand transition">
                        <div class="overflow-hidden mr-4">
                            <h4 class="font-bold text-slate-800 dark:text-white truncate">${d.data().title}</h4>
                            <p class="text-[10px] text-slate-400 truncate mt-1">${url}</p>
                        </div>
                        <div class="flex gap-2 shrink-0">
                            <button onclick="navigator.clipboard.writeText('${url}');alert('KopyalandÄ±')" class="w-10 h-10 rounded-xl bg-slate-50 dark:bg-slate-800 text-slate-500 hover:text-brand hover:bg-indigo-50"><i class="fa-solid fa-copy"></i></button>
                            <button onclick="delLink('${d.id}')" class="w-10 h-10 rounded-xl bg-slate-50 dark:bg-slate-800 text-slate-500 hover:text-red-500 hover:bg-red-50"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>`;
            });
        }
        window.delLink = async (id) => { if(confirm("Siliniyor?")) { await deleteDoc(doc(db, "links", id)); location.reload(); }};

        // --- VISITOR FEATURES (PRO) ---
        async function loadVisitor() {
            const d = await getDoc(doc(db, "links", lid));
            if(!d.exists()) { document.body.innerHTML = "<h1 class='text-center mt-20 font-black'>LÄ°NK BULUNAMADI</h1>"; return; }
            
            document.getElementById('vTitle').innerText = d.data().title;
            const tSnap = await getDocs(collection(db, "links", lid, "tasks"));
            const tasks = [];
            tSnap.forEach(t => tasks.push(t.data()));

            const list = document.getElementById('vTaskList');
            
            if(tasks.length === 0) { unlock(d.data().target); return; }

            list.innerHTML = tasks.map((t, i) => `
                <div id="step-${i}" class="task-item bg-white dark:bg-slate-900 p-4 rounded-2xl shadow-sm border dark:border-slate-800 flex items-center justify-between ${i!==0?'opacity-50 grayscale pointer-events-none':''}">
                    <div class="flex items-center gap-4">
                        <div id="icon-bg-${i}" class="w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-400 font-bold text-sm">
                            ${i+1}
                        </div>
                        <p class="font-bold text-sm">${t.name}</p>
                    </div>
                    <button id="btn-${i}" onclick="runTask(${i}, '${t.link}')" class="px-4 py-2 bg-slate-100 dark:bg-slate-800 rounded-lg text-xs font-bold text-slate-600 dark:text-slate-300">
                        GÄ°T
                    </button>
                </div>
            `).join('');

            window.runTask = (i, url) => {
                window.open(url, '_blank');
                const btn = document.getElementById(`btn-${i}`);
                let s = 8;
                
                const timer = setInterval(() => {
                    btn.innerText = s + "s";
                    btn.disabled = true;
                    s--;
                    if(s < 0) {
                        clearInterval(timer);
                        completeStep(i, tasks.length, d.data().target);
                    }
                }, 1000);
            };
        }

        function completeStep(i, total, target) {
            // GÃ¶rsel GÃ¼ncelleme
            const row = document.getElementById(`step-${i}`);
            row.classList.add('task-done');
            document.getElementById(`icon-bg-${i}`).classList.replace('bg-slate-100', 'bg-green-500');
            document.getElementById(`icon-bg-${i}`).classList.add('text-white');
            document.getElementById(`icon-bg-${i}`).innerHTML = '<i class="fa-solid fa-check"></i>';
            document.getElementById(`btn-${i}`).innerText = "TAMAM";
            document.getElementById(`btn-${i}`).classList.add('hidden');

            if(i + 1 < total) {
                const next = document.getElementById(`step-${i+1}`);
                next.classList.remove('opacity-50', 'grayscale', 'pointer-events-none');
            } else {
                unlock(target);
            }
        }

        function unlock(url) {
            // Konfeti Patlat
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });

            const btn = document.getElementById('vUnlock');
            btn.disabled = false;
            btn.classList.remove('bg-slate-200', 'scale-95', 'opacity-50', 'text-slate-400');
            btn.classList.add('bg-brand', 'text-white', 'scale-100', 'opacity-100', 'shadow-xl', 'shadow-brand/40', 'animate-bounce');
            btn.innerHTML = `<i class="fa-solid fa-cloud-arrow-down mr-2"></i> DOSYAYI Ä°NDÄ°R`;
            btn.onclick = () => location.href = url;
        }

    </script>
</body>
</html>