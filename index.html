<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#000000">
    <meta name="description" content="NVOLINK Enterprise Link Management SaaS">
    <meta name="copyright" content="NVOLINK Corp 2026">
    <title>NVOLINK | U-1.0.0 CONSOLE</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: '#050505',
                        panel: '#0f0f10',
                        border: '#27272a',
                        brand: '#6366f1', // Indigo
                        brandDark: '#4338ca',
                        success: '#10b981',
                    },
                    fontFamily: { 
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    }
                }
            }
        }
    </script>

    <style>
        /* --- ENTERPRISE CSS --- */
        body { background-color: var(--bg); color: #a1a1aa; font-family: 'Inter', sans-serif; overflow: hidden; }
        
        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #6366f1; }

        /* LAYOUT */
        .app-container { display: flex; height: 100vh; width: 100vw; }
        .sidebar { width: 260px; background: #0a0a0c; border-right: 1px solid #27272a; display: flex; flex-direction: column; transition: 0.3s; z-index: 50; }
        .main-area { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .content-scroll { flex: 1; overflow-y: auto; padding: 2rem; }

        /* LOGO REPLICA */
        .logo-box {
            width: 40px; height: 40px;
            background: linear-gradient(135deg, #22d3ee 0%, #4f46e5 100%);
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.3);
        }

        /* UI ELEMENTS */
        .nav-item {
            display: flex; items-center; gap: 12px; padding: 12px 16px; margin: 4px 12px;
            border-radius: 8px; color: #71717a; font-size: 13px; font-weight: 600;
            transition: all 0.2s; cursor: pointer;
        }
        .nav-item:hover { background: rgba(255,255,255,0.03); color: #e4e4e7; }
        .nav-item.active { background: rgba(99, 102, 241, 0.1); color: #818cf8; border-left: 3px solid #6366f1; }
        
        .card { background: #0f0f10; border: 1px solid #27272a; border-radius: 12px; overflow: hidden; }
        .stat-card { padding: 20px; display: flex; flex-direction: column; justify-content: space-between; height: 120px; }

        .btn-action {
            padding: 8px 16px; background: #6366f1; color: white; border-radius: 6px; font-size: 12px; font-weight: 600;
            transition: 0.2s; display: inline-flex; align-items: center; gap: 6px;
        }
        .btn-action:hover { background: #4f46e5; box-shadow: 0 0 15px rgba(99,102,241,0.4); }

        .table-row { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 0.5fr; gap: 10px; padding: 16px; border-bottom: 1px solid #27272a; align-items: center; font-size: 13px; transition: 0.2s; }
        .table-row:hover { background: #151518; }
        .table-head { font-weight: 700; color: #e4e4e7; background: #121215; border-bottom: 1px solid #27272a; }

        /* MOBILE OVERRIDES */
        @media (max-width: 768px) {
            .sidebar { position: fixed; left: -260px; height: 100%; box-shadow: 10px 0 30px rgba(0,0,0,0.5); }
            .sidebar.open { left: 0; }
            .content-scroll { padding: 1rem; }
            .table-row { grid-template-columns: 1fr; gap: 5px; padding: 12px; border: 1px solid #27272a; margin-bottom: 10px; rounded: 8px; }
            .table-head { display: none; }
            .desktop-only { display: none; }
        }

        /* ANIMATIONS */
        @keyframes scan { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }
        .boot-screen { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; align-items: center; justify-content: center; font-family: 'JetBrains Mono', monospace; }
        .hidden-force { display: none !important; }
    </style>
</head>
<body>

    <div id="bootScreen" class="boot-screen flex-col">
        <div class="logo-box mb-8 scale-150 animate-pulse"><i class="fa-solid fa-infinity text-white text-xl"></i></div>
        <div class="text-xs text-indigo-500 mb-2">INITIALIZING KERNEL U-1.0.0...</div>
        <div class="w-64 h-1 bg-gray-900 rounded overflow-hidden">
            <div class="h-full bg-indigo-500 w-0 transition-all duration-[2000ms] ease-out" id="bootBar"></div>
        </div>
        <div class="mt-4 text-[10px] text-gray-600 font-mono">
            > Loading Assets... OK<br>
            > Checking Security Rules... OK<br>
            > Connecting to SaaS Cloud... OK
        </div>
    </div>

    <div class="app-container">
        <aside id="sidebar" class="sidebar">
            <div class="h-16 flex items-center px-6 border-b border-[#27272a]">
                <div class="logo-box scale-75 mr-3"><i class="fa-solid fa-infinity text-white"></i></div>
                <div>
                    <h1 class="text-white font-bold tracking-tight">NVO<span class="text-indigo-400">LINK</span></h1>
                    <div class="text-[9px] font-mono text-gray-500">ENTERPRISE SAAS</div>
                </div>
            </div>

            <nav class="flex-1 py-6">
                <div class="px-6 mb-2 text-[10px] font-bold text-gray-600 uppercase tracking-wider">Management</div>
                <div class="nav-item active" onclick="app.route('dashboard')"><i class="fa-solid fa-chart-pie w-5"></i> Dashboard</div>
                <div class="nav-item" onclick="app.route('repository')"><i class="fa-solid fa-database w-5"></i> Repository (Public)</div>
                <div class="nav-item" onclick="app.route('my-assets')"><i class="fa-solid fa-folder-tree w-5"></i> My Assets</div>
                
                <div class="px-6 mt-6 mb-2 text-[10px] font-bold text-gray-600 uppercase tracking-wider">System</div>
                <div class="nav-item" onclick="app.route('patch-notes')"><i class="fa-solid fa-terminal w-5"></i> Patch Notes <span class="ml-auto text-[9px] bg-green-900 text-green-400 px-1.5 rounded">NEW</span></div>
                <div class="nav-item" onclick="app.route('settings')"><i class="fa-solid fa-sliders w-5"></i> Configuration</div>
            </nav>

            <div class="p-4 border-t border-[#27272a]">
                <div id="userCard" class="flex items-center gap-3 p-2 rounded-lg hover:bg-white/5 cursor-pointer transition">
                    <div class="w-8 h-8 rounded bg-gray-800 flex items-center justify-center text-xs"><i class="fa-solid fa-user"></i></div>
                    <div class="overflow-hidden">
                        <div id="uName" class="text-xs font-bold text-white truncate">Guest User</div>
                        <div class="text-[9px] text-gray-500">Not Authenticated</div>
                    </div>
                </div>
            </div>
        </aside>

        <main class="main-area bg-[#050505]">
            <header class="h-16 border-b border-[#27272a] flex items-center justify-between px-6 bg-[#050505]/80 backdrop-blur z-40">
                <button class="md:hidden text-gray-400" onclick="document.getElementById('sidebar').classList.toggle('open')"><i class="fa-solid fa-bars"></i></button>
                <div class="text-xs font-mono text-gray-500 hidden md:block">ver: U-1.0.0-stable | region: eu-central-1</div>
                <div class="flex items-center gap-4">
                    <button onclick="app.openModal('create')" class="btn-action"><i class="fa-solid fa-plus"></i> NEW LINK</button>
                </div>
            </header>

            <div id="viewContainer" class="content-scroll">
                
                <div id="view-dashboard" class="space-y-6 animate-fade">
                    <h2 class="text-xl font-bold text-white">System Overview</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="card stat-card border-l-4 border-indigo-500">
                            <div class="text-gray-500 text-xs font-bold uppercase">Total Traffic</div>
                            <div id="d-views" class="text-3xl font-mono text-white">0</div>
                            <div class="text-[10px] text-green-500"><i class="fa-solid fa-arrow-up"></i> Live Tracking</div>
                        </div>
                        <div class="card stat-card border-l-4 border-cyan-500">
                            <div class="text-gray-500 text-xs font-bold uppercase">Active Links</div>
                            <div id="d-links" class="text-3xl font-mono text-white">0</div>
                            <div class="text-[10px] text-gray-500">In Database</div>
                        </div>
                        <div class="card stat-card border-l-4 border-purple-500">
                            <div class="text-gray-500 text-xs font-bold uppercase">System Status</div>
                            <div class="text-xl font-bold text-green-400">OPERATIONAL</div>
                            <div class="text-[10px] text-gray-500">Uptime 99.9%</div>
                        </div>
                        <div class="card stat-card border-l-4 border-gray-700">
                            <div class="text-gray-500 text-xs font-bold uppercase">Account Tier</div>
                            <div id="d-tier" class="text-xl font-bold text-white">FREE</div>
                            <button onclick="ui.toast('Enterprise Plan locked')" class="text-[10px] text-indigo-400 text-left hover:underline">Upgrade Plan ></button>
                        </div>
                    </div>

                    <div class="card p-6 h-64 flex flex-col">
                        <div class="flex justify-between mb-4">
                            <h3 class="font-bold text-sm text-white">Traffic Analytics (7 Days)</h3>
                            <select class="bg-black border border-gray-800 text-[10px] rounded px-2"><option>Last 7 Days</option></select>
                        </div>
                        <div class="flex-1 flex items-end gap-2 px-4 pb-2 border-b border-gray-800 relative">
                            <div class="w-full bg-indigo-500/20 hover:bg-indigo-500/40 transition h-[30%] rounded-t"></div>
                            <div class="w-full bg-indigo-500/20 hover:bg-indigo-500/40 transition h-[50%] rounded-t"></div>
                            <div class="w-full bg-indigo-500/20 hover:bg-indigo-500/40 transition h-[40%] rounded-t"></div>
                            <div class="w-full bg-indigo-500/20 hover:bg-indigo-500/40 transition h-[80%] rounded-t"></div>
                            <div class="w-full bg-indigo-500/20 hover:bg-indigo-500/40 transition h-[60%] rounded-t"></div>
                            <div class="w-full bg-indigo-500/20 hover:bg-indigo-500/40 transition h-[90%] rounded-t"></div>
                            <div class="w-full bg-indigo-500 hover:bg-indigo-400 transition h-[70%] rounded-t shadow-[0_0_15px_rgba(99,102,241,0.5)]"></div>
                        </div>
                        <div class="flex justify-between text-[9px] text-gray-600 mt-2 px-4">
                            <span>MON</span><span>TUE</span><span>WED</span><span>THU</span><span>FRI</span><span>SAT</span><span>SUN</span>
                        </div>
                    </div>
                </div>

                <div id="view-repository" class="hidden animate-fade">
                    <div class="flex justify-between items-end mb-6">
                        <div>
                            <h2 class="text-xl font-bold text-white">Global Repository</h2>
                            <p class="text-xs text-gray-500">Access shared resources from the enterprise network.</p>
                        </div>
                        <input id="searchRepo" onkeyup="app.loadRepo()" type="text" placeholder="Search ID or Name..." class="bg-[#0f0f10] border border-[#27272a] text-xs p-2 rounded w-64 text-white focus:border-indigo-500 outline-none">
                    </div>

                    <div class="card">
                        <div class="table-row table-head">
                            <div>ASSET NAME</div>
                            <div>CATEGORY</div>
                            <div>AUTHOR</div>
                            <div>METRICS</div>
                            <div>ACTION</div>
                        </div>
                        <div id="repoList" class="divide-y divide-[#27272a]">
                            </div>
                    </div>
                </div>

                <div id="view-my-assets" class="hidden animate-fade">
                    <h2 class="text-xl font-bold text-white mb-6">My Assets Manager</h2>
                    <div class="card">
                        <div class="table-row table-head">
                            <div>TITLE</div>
                            <div>TARGET URL</div>
                            <div>CREATED</div>
                            <div>CLICKS</div>
                            <div>MANAGE</div>
                        </div>
                        <div id="myList" class="divide-y divide-[#27272a]">
                            </div>
                    </div>
                </div>

                <div id="view-patch-notes" class="hidden animate-fade max-w-2xl">
                    <h2 class="text-xl font-bold text-white mb-4">System Changelog</h2>
                    <div class="space-y-4 font-mono text-xs">
                        
                        <div class="p-4 border border-green-900/50 bg-green-900/10 rounded-lg">
                            <div class="flex justify-between mb-2">
                                <span class="font-bold text-green-400">VERSION U-1.0.0 (STABLE)</span>
                                <span class="text-gray-500">2026-01-09</span>
                            </div>
                            <ul class="list-disc list-inside space-y-1 text-gray-400">
                                <li><strong>Core:</strong> Removed Beta branding. System is now Gold Master.</li>
                                <li><strong>UI:</strong> Complete overhaul. Moved from "Social Feed" to "SaaS Dashboard".</li>
                                <li><strong>Security:</strong> Implemented Strict Firestore Rules v2.</li>
                                <li><strong>Engine:</strong> Improved Link Gateway compression logic (faster loads).</li>
                                <li><strong>Database:</strong> Optimized indexing for >1M records.</li>
                                <li><strong>Legal:</strong> Added GDPR compliance footer and copyright.</li>
                            </ul>
                        </div>

                        <div class="p-4 border border-gray-800 rounded-lg opacity-60">
                            <div class="flex justify-between mb-2">
                                <span class="font-bold text-gray-400">VERSION G-1.6.4 (BETA)</span>
                                <span class="text-gray-600">Previous</span>
                            </div>
                            <ul class="list-disc list-inside space-y-1 text-gray-500">
                                <li>Added Image Compression Engine V2.</li>
                                <li>Fixed Link Creation bug.</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <footer class="mt-12 border-t border-[#27272a] pt-6 pb-12 text-[10px] text-gray-600 flex flex-col md:flex-row justify-between">
                    <div>
                        &copy; 2026 NVOLINK Corporation. All rights reserved.<br>
                        Enterprise SaaS Solutions for Digital Asset Management.
                    </div>
                    <div class="flex gap-4 mt-2 md:mt-0">
                        <a href="#" class="hover:text-gray-400">Privacy Policy</a>
                        <a href="#" class="hover:text-gray-400">Terms of Service</a>
                        <a href="#" class="hover:text-gray-400">Support</a>
                    </div>
                </footer>

            </div>
        </main>
    </div>

    <div id="modalCreate" class="fixed inset-0 z-50 bg-black/80 hidden items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-[#0f0f10] border border-[#27272a] w-full max-w-lg rounded-xl shadow-2xl p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold text-white">Create New Asset</h3>
                <button onclick="app.closeModal('create')" class="text-gray-500 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="text-xs font-bold text-gray-500 block mb-1">ASSET TITLE</label>
                    <input id="cTitle" type="text" class="w-full bg-black border border-[#27272a] text-white p-3 rounded text-sm focus:border-indigo-500 outline-none">
                </div>
                
                <div class="flex gap-4">
                    <div class="flex-1">
                        <label class="text-xs font-bold text-gray-500 block mb-1">TARGET URL (LOCKED)</label>
                        <input id="cUrl" type="text" placeholder="https://..." class="w-full bg-black border border-[#27272a] text-white p-3 rounded text-sm focus:border-indigo-500 outline-none">
                    </div>
                    <div class="w-1/3">
                        <label class="text-xs font-bold text-gray-500 block mb-1">CATEGORY</label>
                        <select id="cCat" class="w-full bg-black border border-[#27272a] text-white p-3 rounded text-sm outline-none">
                            <option>Script</option><option>Software</option><option>Config</option><option>Media</option><option>Other</option>
                        </select>
                    </div>
                </div>

                <div onclick="document.getElementById('cImg').click()" class="border border-dashed border-[#27272a] rounded p-4 text-center cursor-pointer hover:bg-white/5 transition">
                    <span id="imgName" class="text-xs text-gray-500"><i class="fa-solid fa-upload mr-2"></i> Upload Cover Image</span>
                    <input type="file" id="cImg" class="hidden" accept="image/*" onchange="app.handleImg(this)">
                </div>

                <div class="bg-black/50 p-3 rounded border border-[#27272a]">
                    <div class="flex justify-between mb-2"><span class="text-xs font-bold text-gray-500">VERIFICATION TASKS</span></div>
                    <div id="taskList" class="space-y-2 mb-2"></div>
                    <div class="flex gap-2">
                        <input id="tName" placeholder="Task Name" class="bg-[#0f0f10] border border-[#27272a] text-xs p-2 rounded flex-1 text-white">
                        <input id="tLink" placeholder="Task URL" class="bg-[#0f0f10] border border-[#27272a] text-xs p-2 rounded flex-1 text-white">
                        <button onclick="app.addTask()" class="bg-indigo-600 text-white px-3 rounded text-xs"><i class="fa-solid fa-plus"></i></button>
                    </div>
                </div>

                <button onclick="app.publish()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 rounded transition shadow-[0_0_15px_rgba(99,102,241,0.3)]">INITIALIZE ASSET</button>
            </div>
        </div>
    </div>

    <div id="modalGate" class="fixed inset-0 z-[60] bg-[#050505]/95 hidden items-center justify-center p-4">
        <div class="w-full max-w-md bg-[#0f0f10] border border-indigo-500/30 rounded-2xl p-8 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 to-indigo-600"></div>
            
            <div class="text-center mb-8">
                <div class="logo-box mx-auto mb-4 scale-75"><i class="fa-solid fa-shield-halved text-white"></i></div>
                <h2 id="gTitle" class="text-xl font-bold text-white">Secure Gateway</h2>
                <p class="text-xs text-gray-500 mt-2">Complete verifications to decrypt the destination.</p>
            </div>

            <div id="gTasks" class="space-y-3 mb-8">
                </div>

            <button id="gBtn" disabled class="w-full bg-[#18181b] border border-[#27272a] text-gray-500 py-4 rounded-xl font-bold text-sm flex items-center justify-center gap-2 cursor-not-allowed transition-all">
                <i class="fa-solid fa-lock"></i> LOCKED
            </button>
            
            <button onclick="app.closeModal('gate')" class="absolute top-4 right-4 text-gray-600 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, where, serverTimestamp, deleteDoc, doc, updateDoc, increment, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // CONFIG (Placeholder kept as requested)
        const appFB = initializeApp({ apiKey: "AIzaSyDc1sWTsgQC4yqZnEKP4GutuNWcUCZGhv0", authDomain: "nvo-link.firebaseapp.com", projectId: "nvo-link", storageBucket: "nvo-link.firebasestorage.app" });
        const auth = getAuth(appFB);
        const db = getFirestore(appFB);
        const provider = new GoogleAuthProvider();

        let currentUser = null;
        let tempImg = null;
        let currentTasks = [];
        let viewCache = {};

        // --- APP CONTROLLER ---
        window.app = {
            init: () => {
                // Boot Sequence Animation
                document.getElementById('bootBar').style.width = '100%';
                setTimeout(() => {
                    document.getElementById('bootScreen').classList.add('hidden-force');
                }, 2200);
            },

            route: (viewName) => {
                // Nav UI
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                event.currentTarget.classList.add('active');
                
                // View Switch
                document.querySelectorAll('[id^="view-"]').forEach(el => el.classList.add('hidden'));
                document.getElementById('view-'+viewName).classList.remove('hidden');

                if(viewName === 'repository') app.loadRepo();
                if(viewName === 'my-assets') app.loadMyAssets();
            },

            login: async () => {
                try { await signInWithPopup(auth, provider); } catch(e) { console.error(e); }
            },

            // Create Logic
            openModal: (m) => {
                if(!currentUser && m==='create') return app.login();
                document.getElementById('modal'+(m.charAt(0).toUpperCase()+m.slice(1))).classList.remove('hidden');
                document.getElementById('modal'+(m.charAt(0).toUpperCase()+m.slice(1))).classList.add('flex');
            },
            closeModal: (m) => {
                document.getElementById('modal'+(m.charAt(0).toUpperCase()+m.slice(1))).classList.add('hidden');
                document.getElementById('modal'+(m.charAt(0).toUpperCase()+m.slice(1))).classList.remove('flex');
            },

            handleImg: (input) => {
                const file = input.files[0];
                if(file) {
                    const r = new FileReader();
                    r.onload = (e) => {
                        // Simple compression logic
                        const img = new Image();
                        img.src = e.target.result;
                        img.onload = () => {
                            const c = document.createElement('canvas');
                            const ctx = c.getContext('2d');
                            c.width = 100; c.height = 100; // Thumbnail size for table
                            ctx.drawImage(img, 0, 0, 100, 100);
                            tempImg = c.toDataURL('image/jpeg', 0.5);
                            document.getElementById('imgName').innerText = "Image Loaded: " + file.name;
                            document.getElementById('imgName').classList.add('text-green-500');
                        }
                    }
                    r.readAsDataURL(file);
                }
            },

            addTask: () => {
                const n = document.getElementById('tName').value;
                const l = document.getElementById('tLink').value;
                if(n && l) {
                    currentTasks.push({name:n, url:l});
                    app.renderTasks();
                    document.getElementById('tName').value=''; document.getElementById('tLink').value='';
                }
            },
            renderTasks: () => {
                document.getElementById('taskList').innerHTML = currentTasks.map(t => 
                    `<div class="flex justify-between text-[10px] bg-white/5 p-1 rounded text-gray-300"><span>${t.name}</span><span class="text-indigo-400">Linked</span></div>`
                ).join('');
            },

            publish: async () => {
                if(!currentUser) return;
                const t = document.getElementById('cTitle').value;
                const u = document.getElementById('cUrl').value;
                const c = document.getElementById('cCat').value;
                
                if(!t || !u || currentTasks.length === 0) return alert('Missing fields');

                try {
                    await addDoc(collection(db, 'links'), {
                        title: t, target: u, category: c,
                        tasks: currentTasks, image: tempImg || 'https://via.placeholder.com/100',
                        uid: currentUser.uid, views: 0, 
                        createdAt: serverTimestamp()
                    });
                    app.closeModal('create');
                    app.route('my-assets');
                    // Reset
                    currentTasks=[]; tempImg=null; document.getElementById('cTitle').value='';
                } catch(e) { console.error(e); alert('Error: ' + e.message); }
            },

            // Read Logic (Repo)
            loadRepo: async () => {
                const el = document.getElementById('repoList');
                el.innerHTML = '<div class="p-4 text-center text-xs text-gray-500"><i class="fa-solid fa-circle-notch fa-spin"></i> Fetching data...</div>';
                
                const q = query(collection(db, 'links'), orderBy('createdAt', 'desc'));
                const snap = await getDocs(q);
                
                let html = '';
                const search = document.getElementById('searchRepo').value.toLowerCase();

                snap.forEach(d => {
                    const data = d.data();
                    if(search && !data.title.toLowerCase().includes(search)) return;

                    html += `
                    <div class="table-row">
                        <div class="flex items-center gap-3">
                            <img src="${data.image}" class="w-8 h-8 rounded object-cover bg-gray-800">
                            <div>
                                <div class="font-bold text-white">${data.title}</div>
                                <div class="text-[9px] text-gray-500 font-mono">${d.id.slice(0,6)}...</div>
                            </div>
                        </div>
                        <div class="text-xs text-gray-400"><span class="bg-[#18181b] border border-[#27272a] px-2 py-1 rounded">${data.category}</span></div>
                        <div class="text-xs text-gray-500">ID: ${data.uid.slice(0,5)}..</div>
                        <div class="text-xs font-mono text-indigo-400">${data.views} <span class="text-gray-600">reqs</span></div>
                        <div>
                            <button onclick="app.openGate('${d.id}')" class="text-white hover:text-indigo-400 transition"><i class="fa-solid fa-arrow-up-right-from-square"></i></button>
                        </div>
                    </div>`;
                });
                el.innerHTML = html || '<div class="p-4 text-center text-xs text-gray-600">No assets found in repository.</div>';
            },

            // My Assets Logic
            loadMyAssets: async () => {
                if(!currentUser) return document.getElementById('myList').innerHTML = '<div class="p-4 text-center text-xs text-red-500">Authentication Required</div>';
                
                const q = query(collection(db, 'links'), where('uid', '==', currentUser.uid), orderBy('createdAt', 'desc'));
                const snap = await getDocs(q);
                let html = '';
                
                snap.forEach(d => {
                    const data = d.data();
                    html += `
                    <div class="table-row">
                        <div class="font-bold text-white truncate">${data.title}</div>
                        <div class="text-xs text-gray-500 truncate font-mono">${data.target}</div>
                        <div class="text-xs text-gray-500">Just now</div>
                        <div class="text-xs font-mono text-indigo-400">${data.views}</div>
                        <div class="flex gap-3">
                            <button onclick="app.deleteLink('${d.id}')" class="text-red-500 hover:text-red-400"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>`;
                });
                document.getElementById('myList').innerHTML = html;
            },

            deleteLink: async (id) => {
                if(confirm('Confirm deletion of asset ' + id + '?')) {
                    await deleteDoc(doc(db, 'links', id));
                    app.loadMyAssets();
                }
            },

            // Gateway Logic
            openGate: async (id) => {
                app.openModal('gate');
                const snap = await getDoc(doc(db, 'links', id));
                if(!snap.exists()) return;
                const data = snap.data();
                
                // Update view count
                updateDoc(doc(db, 'links', id), { views: increment(1) });

                document.getElementById('gTitle').innerText = data.title;
                const list = document.getElementById('gTasks');
                list.innerHTML = '';
                
                let completed = 0;
                const btn = document.getElementById('gBtn');
                btn.disabled = true;
                btn.innerHTML = '<i class="fa-solid fa-lock"></i> SYSTEM LOCKED';
                btn.className = "w-full bg-[#18181b] border border-[#27272a] text-gray-500 py-4 rounded-xl font-bold text-sm flex items-center justify-center gap-2 cursor-not-allowed";

                data.tasks.forEach((t, i) => {
                    const d = document.createElement('div');
                    d.className = "flex justify-between items-center bg-[#18181b] p-3 rounded-lg border border-[#27272a]";
                    d.innerHTML = `
                        <div class="text-xs font-bold text-gray-300"><i class="fa-solid fa-circle-check text-gray-700 mr-2" id="icon-${i}"></i> ${t.name}</div>
                        <button class="text-[10px] bg-indigo-900/30 text-indigo-400 px-3 py-1.5 rounded border border-indigo-500/30 hover:bg-indigo-500 hover:text-white transition">EXECUTE</button>
                    `;
                    const b = d.querySelector('button');
                    b.onclick = () => {
                        window.open(t.url, '_blank');
                        b.innerText = 'VERIFYING...';
                        b.disabled = true;
                        setTimeout(() => {
                            b.innerText = 'COMPLETE';
                            b.className = 'text-[10px] bg-green-900/30 text-green-400 px-3 py-1.5 rounded border border-green-500/30 cursor-default';
                            document.getElementById('icon-'+i).className = 'fa-solid fa-circle-check text-green-500 mr-2';
                            d.className = "flex justify-between items-center bg-green-900/10 p-3 rounded-lg border border-green-500/30";
                            completed++;
                            if(completed >= data.tasks.length) {
                                btn.disabled = false;
                                btn.innerHTML = 'UNLOCK ACCESS';
                                btn.className = "w-full bg-indigo-600 hover:bg-indigo-500 text-white py-4 rounded-xl font-bold text-sm flex items-center justify-center gap-2 transition shadow-[0_0_20px_rgba(99,102,241,0.5)]";
                                btn.onclick = () => window.location.href = data.target;
                            }
                        }, 5000); // 5s wait time
                    }
                    list.appendChild(d);
                });
            }
        };

        window.ui = {
            toast: (msg) => alert(msg) // Placeholder for custom toast
        };

        // Auth State
        onAuthStateChanged(auth, (u) => {
            if(u) {
                currentUser = u;
                document.getElementById('uName').innerText = u.displayName || 'Enterprise User';
                document.getElementById('uName').nextElementSibling.innerText = 'ID: ' + u.uid.slice(0,8);
                document.getElementById('d-tier').innerText = 'PRO';
                document.getElementById('d-tier').classList.add('text-indigo-400');
            } else {
                currentUser = null;
                document.getElementById('uName').innerText = 'Guest Access';
            }
            app.init();
        });

    </script>
</body>
</html>
