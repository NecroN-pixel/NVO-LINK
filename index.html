
<!DOCTYPE html>
<html lang="tr" class="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#000000">
    <title>NVOLINK | G-1.6.1 RELOAD</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.8.1/vanilla-tilt.min.js"></script> 
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* --- CORE SYSTEM --- */
        :root {
            --bg: #050505;
            --glass: rgba(10, 10, 15, 0.85);
            --border: rgba(255,255,255,0.08);
            --primary: #00f3ff;
            --secondary: #7000ff;
            --danger: #ff003c;
            --gold: #ffd700;
        }
        
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; user-select: none; }
        body { 
            font-family: 'Rajdhani', sans-serif; 
            background: var(--bg); color: #e0e0e0; 
            overflow-x: hidden; cursor: crosshair;
        }

        /* --- BOOT LOADER --- */
        #boot-screen {
            position: fixed; inset: 0; z-index: 99999; background: #000;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            font-family: 'Courier New', monospace;
        }
        .terminal-text { color: var(--primary); font-size: 12px; margin-bottom: 5px; opacity: 0; animation: textFade 0.1s forwards; }
        @keyframes textFade { to { opacity: 1; } }

        /* --- MATRIX BG --- */
        #matrix-canvas { position: fixed; inset: 0; z-index: -2; opacity: 0.1; pointer-events: none; }
        .grid-overlay {
            position: fixed; inset: 0; z-index: -1; pointer-events: none;
            background-image: linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        /* --- UI ELEMENTS --- */
        .glass-panel {
            background: var(--glass); backdrop-filter: blur(15px);
            border: 1px solid var(--border);
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        
        .neon-btn {
            background: rgba(0, 243, 255, 0.05); border: 1px solid var(--primary);
            color: var(--primary); text-transform: uppercase; letter-spacing: 1px;
            transition: 0.3s; position: relative; overflow: hidden;
        }
        .neon-btn:hover { background: var(--primary); color: black; box-shadow: 0 0 15px var(--primary); }

        .input-cyber {
            width: 100%; background: #0a0a0a; border: 1px solid #333;
            color: white; padding: 15px; border-radius: 4px; outline: none;
            font-family: 'Rajdhani', sans-serif; transition: 0.3s;
        }
        .input-cyber:focus { border-color: var(--primary); box-shadow: 0 0 10px rgba(0,243,255,0.2); }

        /* --- NOTIFICATIONS --- */
        .toast-box {
            animation: slideInRight 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            background: rgba(0,0,0,0.9); border-left: 4px solid var(--primary);
        }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* --- TAB SYSTEM --- */
        .tab-view { display: none; opacity: 0; transform: translateY(10px); transition: 0.4s; }
        .tab-view.active { display: block; opacity: 1; transform: translateY(0); }

        /* --- ADMIN BADGE --- */
        .badge-god {
            background: linear-gradient(45deg, #ffd700, #ff8800); -webkit-background-clip: text; color: transparent;
            font-weight: 900; text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        /* --- SCROLLBAR --- */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; }
    </style>
</head>
<body class="pb-32" oncontextmenu="return false;">

    <div id="boot-screen">
        <div id="boot-log" class="w-80 h-48 overflow-hidden mb-4 border-l-2 border-cyan-500 pl-4"></div>
        <div class="w-64 h-1 bg-gray-900 rounded overflow-hidden">
            <div id="boot-bar" class="h-full bg-cyan-500 w-0 transition-all duration-[2000ms]"></div>
        </div>
    </div>

    <canvas id="matrix-canvas"></canvas>
    <div class="grid-overlay"></div>
    <div id="toast-container" class="fixed top-5 right-5 z-[10000] flex flex-col gap-3"></div>

    <header class="fixed top-0 w-full z-50 glass-panel border-b-0 border-b border-white/5 bg-black/80">
        <div class="max-w-2xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3 cursor-pointer" onclick="app.nav('feed')">
                <i class="fa-solid fa-infinity text-3xl text-cyan-400 animate-pulse"></i>
                <div>
                    <h1 class="text-xl font-bold italic tracking-tighter text-white">NVOLINK</h1>
                    <span class="text-[9px] text-cyan-500 font-bold tracking-[0.3em] block">RELOAD 1.6.1</span>
                </div>
            </div>

            <div class="flex items-center gap-2">
                <button onclick="ui.togglePatchNotes()" class="w-8 h-8 rounded bg-white/5 text-gray-400 hover:text-white border border-white/5">
                    <i class="fa-solid fa-scroll"></i>
                </button>
                <button id="loginBtn" class="neon-btn px-4 py-1.5 text-[10px] font-bold rounded">GİRİŞ</button>
                <div id="userBadge" class="hidden items-center gap-2 bg-white/5 px-2 py-1 rounded border border-white/10" onclick="app.nav('profile')">
                    <img id="userImg" class="w-6 h-6 rounded object-cover">
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-2xl mx-auto pt-24 px-4 relative z-10">

        <div id="tab-feed" class="tab-view active">
            <div class="relative mb-6">
                <i class="fa-solid fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-500"></i>
                <input type="text" id="searchInput" onkeyup="app.filterFeed()" placeholder="Sistemde ara..." class="input-cyber pl-10 rounded-full bg-black/50">
            </div>

            <div id="cat-scroll" class="flex gap-2 overflow-x-auto pb-4 mb-2 hide-scroll"></div>
            <div id="feed-list" class="space-y-6 pb-10 min-h-[300px]"></div>
        </div>

        <div id="tab-create" class="tab-view">
            <div class="glass-panel p-6 rounded-2xl border-t-2 border-cyan-500 relative">
                <h2 class="text-2xl font-black mb-1">YENİ MODÜL</h2>
                <div class="text-[10px] text-gray-500 mb-6 font-mono">SERVER: EU-CENTRAL-1 // UPLINK: SECURE</div>

                <div class="space-y-4">
                    <div id="limitInfo" class="bg-blue-900/20 border border-blue-500/30 p-2 rounded text-[10px] text-blue-300 flex justify-between">
                        <span>LİMİT DURUMU:</span>
                        <span id="limitCount" class="font-bold text-white">HESAPLANIYOR...</span>
                    </div>

                    <div class="relative group" onclick="document.getElementById('fileUp').click()">
                        <input type="file" id="fileUp" class="hidden" accept="image/*" onchange="app.handleFile(this)">
                        <div class="h-40 border-2 border-dashed border-gray-700 rounded-lg flex flex-col items-center justify-center bg-black/40 hover:border-cyan-500 transition cursor-pointer">
                            <img id="prevImg" class="absolute inset-0 w-full h-full object-cover rounded-lg hidden opacity-60">
                            <i class="fa-solid fa-cloud-arrow-up text-3xl text-gray-600 group-hover:text-cyan-400"></i>
                        </div>
                    </div>

                    <input id="inTitle" type="text" placeholder="MODÜL ADI" class="input-cyber">
                    <input id="inLink" type="url" placeholder="HEDEF URL (https://)" class="input-cyber">
                    
                    <div class="grid grid-cols-2 gap-3">
                        <select id="inCat" class="input-cyber text-gray-400"></select>
                        <input id="inTask" type="text" placeholder="GÖREV (OPS)" class="input-cyber">
                    </div>

                    <button onclick="app.upload()" class="neon-btn w-full py-4 text-sm font-bold rounded mt-2">
                        <i class="fa-solid fa-rocket mr-2"></i> BAŞLAT
                    </button>
                </div>
            </div>
        </div>

        <div id="tab-profile" class="tab-view">
            <div class="glass-panel p-8 rounded-2xl text-center mb-6 relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-cyan-500 to-transparent"></div>
                
                <img id="pAvatar" class="w-28 h-28 rounded-full border-4 border-[#0a0a0a] mx-auto shadow-2xl object-cover">
                <h2 id="pName" class="text-2xl font-black mt-4 text-white tracking-wide">...</h2>
                <div id="pBadges" class="flex justify-center gap-2 mt-2"></div>
                
                <div class="flex justify-center gap-8 mt-6 border-t border-white/5 pt-4">
                    <div>
                        <div id="stFiles" class="text-xl font-bold text-white">0</div>
                        <div class="text-[9px] text-gray-500 uppercase">Dosya</div>
                    </div>
                    <div>
                        <div id="stViews" class="text-xl font-bold text-cyan-400">0</div>
                        <div class="text-[9px] text-gray-500 uppercase">Erişim</div>
                    </div>
                </div>
            </div>

            <div class="flex justify-between items-center mb-4 px-2">
                <h3 class="text-xs font-bold text-gray-500">PAYLAŞILANLAR</h3>
                <span id="profileLimitBadge" class="text-[9px] bg-white/5 px-2 py-1 rounded text-gray-400"></span>
            </div>
            <div id="profile-feed" class="space-y-3"></div>
        </div>

    </main>

    <div id="adminPanel" class="fixed bottom-24 right-4 hidden z-50">
        <button onclick="admin.nuke()" class="bg-red-600 text-white w-10 h-10 rounded-full shadow-lg border-2 border-black flex items-center justify-center animate-pulse">
            <i class="fa-solid fa-biohazard"></i>
        </button>
    </div>

    <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-[#0a0a0a]/90 backdrop-blur-xl border border-white/10 rounded-2xl px-6 py-3 flex items-center gap-8 shadow-2xl z-40">
        <button onclick="app.nav('feed')" id="nav-feed" class="text-cyan-400 text-xl transition hover:-translate-y-1"><i class="fa-solid fa-layer-group"></i></button>
        <div class="w-px h-6 bg-white/10"></div>
        <button onclick="app.nav('create')" class="bg-gradient-to-tr from-cyan-600 to-blue-600 text-white w-12 h-12 rounded-xl -mt-8 flex items-center justify-center border-4 border-[#050505] shadow-lg shadow-cyan-500/20 hover:scale-105 transition">
            <i class="fa-solid fa-plus text-xl font-bold"></i>
        </button>
        <div class="w-px h-6 bg-white/10"></div>
        <button onclick="app.nav('profile')" id="nav-profile" class="text-gray-500 text-xl transition hover:-translate-y-1 hover:text-white"><i class="fa-regular fa-id-card"></i></button>
    </nav>

    <div id="modalGate" class="fixed inset-0 z-[9000] bg-black/95 hidden flex items-center justify-center p-4">
        <div class="glass-panel w-full max-w-sm rounded-xl p-6 text-center border border-cyan-500/30">
            <div id="qr-area" class="bg-white p-2 rounded w-fit mx-auto mb-4"></div>
            <h3 class="text-xl font-bold text-white mb-2">GÜVENLİ BAĞLANTI</h3>
            
            <div id="gateTaskBox" class="hidden bg-yellow-500/10 border border-yellow-500/20 p-3 rounded mb-4">
                <div class="text-[9px] font-bold text-yellow-500 uppercase mb-1">GÖREV GEREKLİ</div>
                <div id="gateTaskText" class="text-sm font-bold text-white">Youtube Abone Ol</div>
            </div>

            <button id="btnGateAction" class="w-full bg-cyan-600 py-3 rounded font-bold text-xs uppercase mb-3">BAĞLANTIYA GİT</button>
            <button onclick="ui.closeModals()" class="text-xs text-gray-500 hover:text-white">KAPAT</button>
        </div>
    </div>

    <div id="modalPatch" class="fixed inset-0 z-[9000] bg-black/90 hidden flex items-center justify-center p-4">
        <div class="glass-panel w-full max-w-md p-6 rounded-xl relative">
            <button onclick="ui.togglePatchNotes()" class="absolute top-4 right-4 text-gray-500 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
            <h2 class="text-2xl font-black italic mb-4">G-1.6.1 <span class="text-cyan-500">RELOAD</span></h2>
            
            <div class="space-y-3 text-sm text-gray-300 font-mono h-64 overflow-y-auto pr-2">
                <div class="p-2 bg-white/5 rounded border-l-2 border-green-500">
                    <strong class="text-white block">LİMİT SİSTEMİ AKTİF</strong>
                    Normal Üyeler: 10 Link<br>
                    Doğrulanmış: 20 Link<br>
                    Admin (Necron): Sınırsız
                </div>
                <div class="p-2 bg-white/5 rounded border-l-2 border-blue-500">
                    <strong class="text-white block">PROFİL HATASI GİDERİLDİ</strong>
                    Artık başkalarının profiline girince boş sayfa çıkmıyor.
                </div>
                <div class="p-2 bg-white/5 rounded border-l-2 border-purple-500">
                    <strong class="text-white block">YENİ BOOT LOADER</strong>
                    Sisteme giriş animasyonu terminal tarzı yapıldı.
                </div>
                 <div class="p-2 bg-white/5 rounded border-l-2 border-red-500">
                    <strong class="text-white block">GÜVENLİK YAMASI</strong>
                    Database query hataları ve form donmaları fixlendi.
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, where, serverTimestamp, deleteDoc, doc, updateDoc, increment, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // --- CONFIG ---
        const appFB = initializeApp({
            apiKey: "AIzaSyDc1sWTsgQC4yqZnEKP4GutuNWcUCZGhv0",
            authDomain: "nvo-link.firebaseapp.com",
            projectId: "nvo-link",
            storageBucket: "nvo-link.firebasestorage.app"
        });
        const auth = getAuth(appFB);
        const db = getFirestore(appFB);
        const provider = new GoogleAuthProvider();

        // --- CONSTANTS ---
        const ADMIN_EMAIL = "necron.offical@gmail.com";
        const VERIFIED_USERS = ["test@gmail.com"]; // Manuel doğrulanmış kullanıcı listesi (Örnek)
        const CATS = ["Hepsi", "Script", "Config", "Tool", "Oyun", "Method", "Premium"];
        
        let user = null;
        let img64 = null;

        // --- MATRIX RAIN ---
        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        const chars = '01XYZ'; const drops = Array(Math.floor(canvas.width/14)).fill(1);
        setInterval(() => {
            ctx.fillStyle = 'rgba(0,0,0,0.05)'; ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.fillStyle = '#0ff'; ctx.font = '14px monospace';
            drops.forEach((y, i) => {
                ctx.fillText(chars[Math.floor(Math.random()*5)], i*14, y*14);
                if(y*14>canvas.height && Math.random()>0.98) drops[i]=0;
                drops[i]++;
            });
        }, 50);

        // --- APP ENGINE ---
        window.app = {
            init: () => {
                // Categories
                const s = document.getElementById('cat-scroll');
                const sel = document.getElementById('inCat');
                s.innerHTML=''; sel.innerHTML='';
                CATS.forEach(c => {
                    s.innerHTML += `<button onclick="app.loadFeed('${c}')" class="px-4 py-1.5 rounded bg-white/5 border border-white/10 text-[10px] font-bold uppercase hover:bg-cyan-500/20 hover:text-cyan-400 transition whitespace-nowrap">${c}</button>`;
                    if(c!=='Hepsi') sel.innerHTML += `<option value="${c}">${c}</option>`;
                });

                // Check URL
                const p = new URLSearchParams(location.search);
                if(p.get('id')) app.openGate(p.get('id'));
            },

            nav: (t, uid) => {
                if((t==='create' || t==='profile') && !user && !uid) return ui.toast('Giriş Yapmalısın!', 'error');
                
                document.querySelectorAll('.tab-view').forEach(e => e.classList.remove('active'));
                document.getElementById('tab-'+t).classList.add('active');
                
                document.getElementById('nav-feed').className = t==='feed'?'text-cyan-400 text-xl':'text-gray-500 text-xl';
                document.getElementById('nav-profile').className = t==='profile'?'text-cyan-400 text-xl':'text-gray-500 text-xl';

                if(t==='feed') app.loadFeed();
                if(t==='profile') app.loadProfile(uid); // Fixed Profile Nav
                if(t==='create') app.checkLimits(); // Update limits text
            },

            // --- CORE: FEED ---
            loadFeed: async (cat='Hepsi') => {
                const list = document.getElementById('feed-list');
                list.innerHTML = `<div class="text-center py-10"><i class="fa-solid fa-circle-notch fa-spin text-cyan-500 text-2xl"></i></div>`;
                
                try {
                    const q = query(collection(db, 'links'), orderBy('createdAt', 'desc'));
                    const snap = await getDocs(q);
                    list.innerHTML = '';

                    snap.forEach(d => {
                        const x = d.data();
                        if(cat!=='Hepsi' && x.category!==cat) return;
                        
                        // Badge logic
                        let badge = '';
                        if(x.uEmail === ADMIN_EMAIL) badge = '<i class="fa-solid fa-skull text-yellow-500 ml-1" title="NECRON ADMIN"></i>';
                        else if(VERIFIED_USERS.includes(x.uEmail)) badge = '<i class="fa-solid fa-circle-check text-blue-500 ml-1"></i>';

                        // Delete button (Owner or Admin)
                        let delBtn = '';
                        if(user && (user.uid === x.uid || user.email === ADMIN_EMAIL)) {
                            delBtn = `<button onclick="app.deleteLink('${d.id}')" class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded text-[9px] z-20 hover:scale-110"><i class="fa-solid fa-trash"></i></button>`;
                        }

                        const div = document.createElement('div');
                        div.className = "glass-panel rounded-xl overflow-hidden relative group";
                        div.innerHTML = `
                            ${delBtn}
                            <div class="h-44 relative cursor-pointer overflow-hidden" onclick="app.openGate('${d.id}')">
                                <img src="${x.image}" class="w-full h-full object-cover transition duration-500 group-hover:scale-105">
                                <div class="absolute inset-0 bg-gradient-to-t from-black/90 to-transparent"></div>
                                <div class="absolute bottom-3 left-3 right-3">
                                    <span class="bg-cyan-500 text-black px-1.5 py-0.5 rounded text-[9px] font-black uppercase">${x.category}</span>
                                    <h3 class="text-white font-bold mt-1 leading-tight text-sm">${x.title}</h3>
                                </div>
                            </div>
                            <div class="p-3 flex items-center justify-between bg-[#080808]">
                                <div class="flex items-center gap-2 cursor-pointer" onclick="app.nav('profile', '${x.uid}')">
                                    <img src="${x.uAvatar}" class="w-6 h-6 rounded-full border border-gray-800">
                                    <span class="text-[10px] text-gray-400 font-bold hover:text-white">${x.uName} ${badge}</span>
                                </div>
                                <div class="text-[10px] text-gray-600 font-bold"><i class="fa-solid fa-eye mr-1"></i>${x.views||0}</div>
                            </div>
                        `;
                        VanillaTilt.init(div, { max:5, speed:400, glare:true, "max-glare":0.2 });
                        list.appendChild(div);
                    });
                } catch(e) { console.error(e); list.innerHTML = `<div class="text-red-500 text-center text-xs">Bağlantı Hatası</div>`; }
            },

            // --- CORE: UPLOAD & LIMITS ---
            checkLimits: async () => {
                if(!user) return;
                const txt = document.getElementById('limitCount');
                txt.innerText = "KONTROL EDİLİYOR...";
                
                const q = query(collection(db, 'links'), where('uid', '==', user.uid));
                const snap = await getDocs(q);
                const count = snap.size;
                
                let limit = 10;
                let status = "NORMAL ÜYE";
                
                if(user.email === ADMIN_EMAIL) { limit = 9999; status = "NECRON (GOD MODE)"; }
                else if(VERIFIED_USERS.includes(user.email)) { limit = 20; status = "DOĞRULANMIŞ"; }

                const color = count >= limit ? 'text-red-500' : 'text-green-500';
                txt.innerHTML = `<span class="${color}">${count}</span> / ${limit === 9999 ? '∞' : limit} (${status})`;
                
                return { count, limit };
            },

            upload: async () => {
                if(!user) return ui.toast('Giriş Yapmalısın!', 'error');
                
                // 1. Check Limit
                const limits = await app.checkLimits();
                if(limits.count >= limits.limit) {
                    ui.toast(`LİMİT DOLDU! (${limits.limit} adet)`, 'error');
                    return;
                }

                // 2. Validate Form
                const t = document.getElementById('inTitle').value;
                const l = document.getElementById('inLink').value;
                const c = document.getElementById('inCat').value;
                const task = document.getElementById('inTask').value;

                if(!t || !l || !img64) return ui.toast('Lütfen tüm alanları doldur!', 'error');

                try {
                    ui.toast('Sisteme yükleniyor...', 'info');
                    await addDoc(collection(db, 'links'), {
                        title: t, target: l, category: c, task: task||'',
                        image: img64, uid: user.uid, uName: user.displayName, uAvatar: user.photoURL, uEmail: user.email,
                        views: 0, createdAt: serverTimestamp()
                    });
                    
                    ui.toast('BAŞARILI! DOSYA EKLENDİ.', 'success');
                    app.nav('feed');
                    // Reset
                    document.getElementById('inTitle').value='';
                    document.getElementById('inLink').value='';
                    img64 = null;
                } catch(e) {
                    ui.toast('HATA: ' + e.message, 'error');
                }
            },

            handleFile: (el) => {
                const f = el.files[0];
                if(f) {
                    const r = new FileReader();
                    r.onload = e => {
                        document.getElementById('prevImg').src = e.target.result;
                        document.getElementById('prevImg').classList.remove('hidden');
                        img64 = e.target.result;
                    };
                    r.readAsDataURL(f);
                }
            },

            // --- CORE: PROFILE (FIXED) ---
            loadProfile: async (targetUid) => {
                // If targetUid is null, try to use current user
                const uid = targetUid || user?.uid;
                
                if(!uid) {
                    ui.toast('Kullanıcı bulunamadı', 'error');
                    app.nav('feed');
                    return;
                }

                const list = document.getElementById('profile-feed');
                list.innerHTML = '<div class="text-center py-4 text-xs text-gray-500">Veriler çekiliyor...</div>';

                // Query specific UID
                const q = query(collection(db, 'links'), where('uid', '==', uid));
                const snap = await getDocs(q);

                let totalViews = 0;
                let userData = { name: 'Bilinmeyen', avatar: '', email: '' };

                if(snap.size > 0) {
                    const d = snap.docs[0].data();
                    userData = { name: d.uName, avatar: d.uAvatar, email: d.uEmail };
                } else if(user && user.uid === uid) {
                    userData = { name: user.displayName, avatar: user.photoURL, email: user.email };
                }

                // Render Header
                document.getElementById('pName').innerText = userData.name;
                document.getElementById('pAvatar').src = userData.avatar || 'https://via.placeholder.com/150';
                
                const badges = document.getElementById('pBadges');
                badges.innerHTML = '';
                if(userData.email === ADMIN_EMAIL) badges.innerHTML = `<span class="badge-god text-[10px] border border-yellow-500 px-2 rounded">NECRON</span>`;
                else if(VERIFIED_USERS.includes(userData.email)) badges.innerHTML = `<span class="text-blue-500 font-bold text-[10px] border border-blue-500 px-2 rounded">VERIFIED</span>`;

                // Render List
                list.innerHTML = '';
                snap.forEach(d => {
                    const x = d.data();
                    totalViews += (x.views || 0);
                    
                    let del = '';
                    if(user && (user.uid === uid || user.email === ADMIN_EMAIL)) {
                        del = `<button onclick="app.deleteLink('${d.id}')" class="text-red-500 text-xs ml-2"><i class="fa-solid fa-trash"></i></button>`;
                    }

                    list.innerHTML += `
                    <div class="flex items-center justify-between p-3 bg-white/5 rounded border border-white/5">
                        <div class="flex items-center gap-3">
                            <img src="${x.image}" class="w-10 h-10 rounded object-cover">
                            <div>
                                <div class="text-xs font-bold text-white">${x.title}</div>
                                <div class="text-[9px] text-gray-500">${x.views} Görüntülenme</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                             <button onclick="navigator.clipboard.writeText('${location.origin}?id=${d.id}')" class="text-gray-500 text-xs"><i class="fa-solid fa-link"></i></button>
                             ${del}
                        </div>
                    </div>`;
                });

                document.getElementById('stFiles').innerText = snap.size;
                document.getElementById('stViews').innerText = totalViews;
                
                // Limit Badge on Profile
                let pLimit = "10 LİMİT";
                if(userData.email === ADMIN_EMAIL) pLimit = "SINIRSIZ";
                else if(VERIFIED_USERS.includes(userData.email)) pLimit = "20 LİMİT";
                document.getElementById('profileLimitBadge').innerText = pLimit;
            },

            deleteLink: async (id) => {
                if(confirm('Dosyayı kalıcı olarak silmek istiyor musun?')) {
                    await deleteDoc(doc(db, 'links', id));
                    ui.toast('Dosya Silindi', 'info');
                    // Refresh current view
                    if(document.getElementById('tab-profile').classList.contains('active')) {
                        const uid = user ? user.uid : null; // Basit refresh
                        app.loadProfile(uid); 
                    } else {
                        app.loadFeed();
                    }
                }
            },

            openGate: async (id) => {
                ui.toggleModal('modalGate');
                const snap = await getDoc(doc(db, 'links', id));
                if(!snap.exists()) return ui.toast('Link bulunamadı', 'error');
                
                const d = snap.data();
                await updateDoc(doc(db, 'links', id), { views: increment(1) });

                document.getElementById('qr-area').innerHTML = '';
                new QRCode(document.getElementById('qr-area'), { text: d.target, width:100, height:100 });

                const btn = document.getElementById('btnGateAction');
                if(d.task) {
                    document.getElementById('gateTaskBox').classList.remove('hidden');
                    document.getElementById('gateTaskText').innerText = d.task;
                    btn.innerText = "GÖREVİ ONAYLA";
                    btn.onclick = () => {
                        btn.innerHTML = "<i class='fa-solid fa-spinner fa-spin'></i> KONTROL EDİLİYOR...";
                        setTimeout(() => window.location.href = d.target, 2000);
                    }
                } else {
                    document.getElementById('gateTaskBox').classList.add('hidden');
                    btn.innerText = "BAĞLANTIYA GİT";
                    btn.onclick = () => window.location.href = d.target;
                }
            }
        };

        // --- UI UTILS ---
        window.ui = {
            toast: (m,t) => {
                const d = document.createElement('div');
                d.className = `toast-box p-3 text-xs font-bold text-white flex items-center gap-2 rounded ${t==='error'?'border-red-500 text-red-400':''}`;
                d.innerHTML = m;
                document.getElementById('toast-container').appendChild(d);
                setTimeout(()=>d.remove(), 3000);
            },
            toggleModal: (id) => document.getElementById(id).classList.remove('hidden'),
            closeModals: () => document.querySelectorAll('[id^="modal"]').forEach(e => e.classList.add('hidden')),
            togglePatchNotes: () => {
                const el = document.getElementById('modalPatch');
                el.classList.contains('hidden') ? el.classList.remove('hidden') : el.classList.add('hidden');
            }
        };

        // --- ADMIN TOOLS ---
        window.admin = {
            nuke: () => alert('BU ÖZELLİK DEVRE DIŞI BIRAKILDI.')
        };

        // --- AUTH & BOOT ---
        document.getElementById('loginBtn').onclick = () => signInWithPopup(auth, provider);
        
        // Boot Sequence
        const bootLog = document.getElementById('boot-log');
        const logs = ["SYSTEM_INIT...", "CONNECTING_DB...", "BYPASSING_FIREWALL...", "LOADING_KERNEL...", "NECRON_ACCESS_GRANTED"];
        let logIndex = 0;
        
        const bootInt = setInterval(() => {
            if(logIndex < logs.length) {
                const div = document.createElement('div');
                div.className = "terminal-text";
                div.innerText = "> " + logs[logIndex];
                bootLog.appendChild(div);
                logIndex++;
            } else {
                clearInterval(bootInt);
            }
        }, 300);

        onAuthStateChanged(auth, u => {
            document.getElementById('boot-bar').style.width = "100%";
            
            setTimeout(() => {
                document.getElementById('boot-screen').style.opacity = '0';
                setTimeout(()=>document.getElementById('boot-screen').style.display='none', 500);
            }, 2200);

            if(u) {
                user = u;
                document.getElementById('loginBtn').classList.add('hidden');
                document.getElementById('userBadge').classList.remove('hidden');
                document.getElementById('userBadge').classList.add('flex');
                document.getElementById('userImg').src = u.photoURL;
                if(u.email === ADMIN_EMAIL) document.getElementById('adminPanel').classList.remove('hidden');
                ui.toast('Sisteme hoşgeldin.', 'success');
            }
            app.init();
            app.loadFeed();
        });

    </script>
</body>
</html>
