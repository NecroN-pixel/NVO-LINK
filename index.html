
<!DOCTYPE html>
<html lang="tr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NVO LINK G-0.0.1 | FULL OMNI</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --p: #00d2ff; --s: #3a7bd5; --bg: #010409; --card: #0d1117; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--bg); color: #f0f6fc; overflow-x: hidden; scroll-behavior: smooth; }

        /* --- PRELOADER (Açılış Ekranı) --- */
        #preloader { position: fixed; inset: 0; z-index: 10000; background: #010409; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 1s ease-in-out; }
        .p-logo { position: relative; animation: float 3s infinite ease-in-out; }
        .p-bar { width: 220px; height: 3px; background: rgba(255,255,255,0.05); border-radius: 10px; margin-top: 30px; overflow: hidden; }
        .p-fill { width: 0%; height: 100%; background: linear-gradient(90deg, var(--p), var(--s)); transition: 0.3s; box-shadow: 0 0 15px var(--p); }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

        /* --- LOGO: GÖRSELDEKİ GLASSMOPHISM --- */
        .nvo-glass-logo {
            background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px;
            padding: 12px 24px; display: flex; align-items: center; gap: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .nvo-rocket { font-size: 26px; color: var(--p); filter: drop-shadow(0 0 10px var(--p)); }
        .nvo-text { font-weight: 800; font-size: 20px; letter-spacing: -0.5px; }
        .nvo-ver { font-size: 14px; color: var(--p); opacity: 0.7; font-weight: 400; }

        /* --- UI & CARDS --- */
        .glass-card { background: rgba(13, 17, 23, 0.7); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.06); border-radius: 30px; }
        .saas-gradient { background: linear-gradient(135deg, var(--p), var(--s)); }
        .page-transition { animation: slideUp 0.6s cubic-bezier(0.23, 1, 0.32, 1); }
        @keyframes slideUp { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }

        /* --- NAVIGATION --- */
        .omni-nav { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 480px; height: 80px; background: rgba(13, 17, 23, 0.85); backdrop-filter: blur(20px); border-radius: 40px; border: 1px solid rgba(255,255,255,0.08); display: flex; justify-content: space-around; align-items: center; z-index: 5000; box-shadow: 0 30px 60px rgba(0,0,0,0.6); }
        .nav-item { color: #484f58; font-size: 22px; transition: 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55); position: relative; }
        .nav-item.active { color: var(--p); transform: translateY(-10px) scale(1.1); }
        .nav-item.active::after { content: ''; position: absolute; bottom: -12px; left: 50%; transform: translateX(-50%); width: 6px; height: 6px; background: var(--p); border-radius: 50%; box-shadow: 0 0 15px var(--p); }

        /* Inputs */
        input, select, textarea { background: #0d1117 !important; border: 1px solid #30363d !important; border-radius: 20px !important; color: white !important; padding: 15px 20px !important; transition: 0.3s; }
        input:focus { border-color: var(--p) !important; box-shadow: 0 0 0 4px rgba(0, 210, 255, 0.1); outline: none; }

        .cat-chip { padding: 8px 20px; border-radius: 100px; font-size: 11px; font-weight: 800; background: #161b22; border: 1px solid #30363d; color: #8b949e; cursor: pointer; transition: 0.3s; white-space: nowrap; }
        .cat-chip.active { background: var(--p); color: white; border-color: var(--p); box-shadow: 0 0 20px rgba(0, 210, 255, 0.3); }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #30363d; border-radius: 10px; }
    </style>
</head>
<body class="pb-36">

    <div id="preloader">
        <div class="nvo-glass-logo p-logo">
            <i class="fa-solid fa-rocket nvo-rocket"></i>
            <span class="nvo-text">NVO LINK <span class="nvo-ver">G-0.0.1</span></span>
        </div>
        <div class="p-bar"><div id="p-fill" class="p-fill"></div></div>
        <p class="mt-6 text-[10px] font-black text-slate-500 uppercase tracking-[0.4em]">Sistem Yükleniyor...</p>
    </div>

    <header class="sticky top-0 z-[1000] glass-card border-none rounded-none px-6 py-5 flex justify-between items-center">
        <div class="nvo-glass-logo scale-90 -ml-4" onclick="location.reload()">
            <i class="fa-solid fa-rocket nvo-rocket"></i>
            <span class="nvo-text text-base">NVO LINK</span>
        </div>
        <div id="authArea" class="flex items-center gap-4">
            <button onclick="login()" id="loginBtn" class="bg-white text-black px-6 py-2.5 rounded-2xl font-black text-xs shadow-xl transition active:scale-95">GİRİŞ YAP</button>
        </div>
    </header>

    <main class="max-w-2xl mx-auto px-4 mt-8">
        
        <section id="discovery-tools" class="mb-10 space-y-5 page-transition">
            <div class="relative">
                <i class="fa-solid fa-magnifying-glass absolute left-5 top-1/2 -translate-y-1/2 text-slate-500"></i>
                <input type="text" id="globalSearch" placeholder="Link, hesap veya kategori ara..." class="w-full pl-14">
            </div>
            <div class="flex gap-3 overflow-x-auto no-scrollbar pb-2" id="categories">
                <div class="cat-chip active" onclick="setCat('Hepsi', this)">Hepsi</div>
                <div class="cat-chip" onclick="setCat('Oyun', this)">Oyun</div>
                <div class="cat-chip" onclick="setCat('Yazılım', this)">Yazılım</div>
                <div class="cat-chip" onclick="setCat('Eğitim', this)">Eğitim</div>
                <div class="cat-chip" onclick="setCat('Medya', this)">Medya</div>
                <div class="cat-chip" onclick="setCat('Diğer', this)">Diğer</div>
            </div>
        </section>

        <section id="view-discovery" class="tab-view space-y-8 page-transition">
            <div id="discoveryFeed" class="grid grid-cols-1 gap-8">
                </div>
        </section>

        <section id="view-accounts" class="tab-view hidden space-y-6 page-transition">
            <h2 class="text-xs font-black text-slate-500 uppercase tracking-widest ml-2">Popüler İçerik Üreticileri</h2>
            <div id="accountsList" class="space-y-4">
                </div>
        </section>

        <section id="view-create" class="tab-view hidden page-transition">
            <div class="glass-card p-10 space-y-8">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 saas-gradient rounded-3xl flex items-center justify-center shadow-2xl rotate-6"><i class="fa-solid fa-cloud-arrow-up text-2xl text-white"></i></div>
                    <div>
                        <h2 class="text-2xl font-black">Kampanya Oluştur</h2>
                        <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">G-0.0.1 Full Gateway</p>
                    </div>
                </div>

                <div onclick="document.getElementById('fileImg').click()" class="w-full h-60 bg-slate-900/50 rounded-[2.5rem] border-2 border-dashed border-slate-800 flex flex-col items-center justify-center cursor-pointer overflow-hidden relative group">
                    <img id="imgPreview" class="hidden w-full h-full object-cover">
                    <div id="imgUI" class="text-center group-hover:scale-110 transition">
                        <i class="fa-solid fa-wand-magic-sparkles text-4xl text-cyan-500 mb-4"></i>
                        <p class="text-xs font-black text-white uppercase">Kapak Resmini Seç</p>
                    </div>
                </div>
                <input type="file" id="fileImg" class="hidden" accept="image/*" onchange="handleImage(this)">

                <div class="space-y-4">
                    <input type="text" id="lTitle" placeholder="İçerik Başlığı (Örn: GTA 6 Mod Menü)" class="w-full">
                    <input type="text" id="lTarget" placeholder="Hedef URL (Kilitli Dosya Linki)" class="w-full">
                    <select id="lCat" class="w-full">
                        <option value="Diğer">Kategori Seçin</option>
                        <option value="Oyun">Oyun</option>
                        <option value="Yazılım">Yazılım</option>
                        <option value="Eğitim">Eğitim</option>
                        <option value="Medya">Medya</option>
                    </select>
                </div>

                <div class="bg-slate-900/30 p-6 rounded-[2rem] border border-white/5 space-y-4">
                    <div class="flex justify-between items-center px-2">
                        <span class="text-[10px] font-black text-cyan-400 uppercase">Görev Listesi</span>
                        <span id="stepCount" class="text-[10px] bg-cyan-500 text-white px-3 py-1 rounded-full font-black">0</span>
                    </div>
                    <div id="builderSteps" class="space-y-2"></div>
                    <div class="grid grid-cols-2 gap-3 pt-4 border-t border-white/5">
                        <select id="sIcon" class="text-xs">
                            <option value="youtube">YouTube</option>
                            <option value="discord">Discord</option>
                            <option value="instagram">Instagram</option>
                            <option value="link">Website</option>
                        </select>
                        <button onclick="addStep()" class="bg-white/5 py-4 rounded-2xl text-[10px] font-black hover:bg-white/10 transition uppercase tracking-widest">+ Adım Ekle</button>
                    </div>
                </div>

                <button onclick="publishCampaign()" id="pubBtn" class="w-full py-6 saas-gradient rounded-[2.5rem] font-black text-white shadow-2xl shadow-cyan-500/20 hover:scale-105 active:scale-95 transition-all">
                    KAMPANYAYI YAYINLA
                </button>
            </div>
        </section>

        <section id="view-profile" class="tab-view hidden page-transition">
            <div class="glass-card p-12 text-center relative overflow-hidden">
                <div class="absolute -top-24 -right-24 w-64 h-64 saas-gradient opacity-10 blur-[100px]"></div>
                
                <div class="relative w-36 h-36 mx-auto mb-8">
                    <img id="pAvatar" src="" class="w-full h-full rounded-[3.5rem] object-cover border-4 border-cyan-500/20 shadow-2xl">
                    <button onclick="document.getElementById('editAv').click()" class="absolute -right-2 -bottom-2 w-12 h-12 saas-gradient rounded-2xl border-4 border-bg flex items-center justify-center shadow-xl"><i class="fa-solid fa-camera text-white"></i></button>
                    <input type="file" id="editAv" class="hidden" onchange="updateProfileAvatar(this)">
                </div>

                <div class="space-y-2 mb-10">
                    <div class="flex justify-center items-center gap-2">
                        <input type="text" id="pName" class="text-center font-black text-3xl bg-transparent border-none w-auto focus:ring-0" onchange="updateProfileName(this.value)">
                        <i class="fa-solid fa-circle-check text-cyan-500 text-sm"></i>
                    </div>
                    <p id="pEmail" class="text-xs text-slate-500 font-bold tracking-widest uppercase"></p>
                </div>

                <div class="grid grid-cols-3 gap-4 mb-10">
                    <div class="bg-white/5 p-5 rounded-[2rem]">
                        <h4 id="statLinks" class="text-2xl font-black">0</h4>
                        <p class="text-[9px] text-slate-500 font-black uppercase mt-1">Paylaşım</p>
                    </div>
                    <div class="bg-white/5 p-5 rounded-[2rem]">
                        <h4 id="statFollowers" class="text-2xl font-black">0</h4>
                        <p class="text-[9px] text-slate-500 font-black uppercase mt-1">Takipçi</p>
                    </div>
                    <div class="bg-white/5 p-5 rounded-[2rem]">
                        <h4 id="statViews" class="text-2xl font-black">0</h4>
                        <p class="text-[9px] text-slate-500 font-black uppercase mt-1">İzlenme</p>
                    </div>
                </div>

                <button onclick="auth.signOut().then(()=>location.reload())" class="w-full py-5 bg-red-500/5 text-red-500 rounded-3xl font-black text-[10px] tracking-[0.2em] uppercase hover:bg-red-500/10 transition">Oturumu Kapat</button>
            </div>

            <div class="mt-12 space-y-4">
                <h3 class="text-xs font-black text-slate-500 uppercase tracking-widest ml-4">Paylaştığın Linkler</h3>
                <div id="myLinksList" class="space-y-4"></div>
            </div>
        </section>

    </main>

    <div id="gatewayView" class="hidden fixed inset-0 z-[6000] bg-[#010409] overflow-y-auto page-transition">
        </div>

    <nav id="omniNav" class="omni-nav hidden">
        <button onclick="switchTab('discovery')" class="nav-item active" id="nav-discovery"><i class="fa-solid fa-compass"></i></button>
        <button onclick="switchTab('accounts')" class="nav-item" id="nav-accounts"><i class="fa-solid fa-users"></i></button>
        <button onclick="switchTab('create')" class="nav-item" id="nav-create"><i class="fa-solid fa-circle-plus text-4xl text-cyan-500"></i></button>
        <button onclick="switchTab('profile')" class="nav-item" id="nav-profile"><i class="fa-solid fa-user-gear"></i></button>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, doc, getDoc, getDocs, updateDoc, deleteDoc, query, where, orderBy, limit, serverTimestamp, increment, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDc1sWTsgQC4yqZnEKP4GutuNWcUCZGhv0",
            authDomain: "nvo-link.firebaseapp.com",
            projectId: "nvo-link",
            storageBucket: "nvo-link.firebasestorage.app",
            messagingSenderId: "256153773846",
            appId: "1:256153773846:web:6d51174db82ccccf119237"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        let currentUser = null;
        let base64 = null;
        let tempSteps = [];
        let activeCat = "Hepsi";
        const linkId = new URLSearchParams(window.location.search).get('id');

        // --- 1. PRELOADER & AUTH ---
        let loadP = 0;
        const loadItv = setInterval(() => {
            loadP += Math.floor(Math.random() * 20) + 5;
            if(loadP >= 100) {
                loadP = 100; clearInterval(loadItv);
                setTimeout(() => {
                    document.getElementById('preloader').style.opacity = '0';
                    setTimeout(() => document.getElementById('preloader').remove(), 1000);
                }, 500);
            }
            document.getElementById('p-fill').style.width = loadP + '%';
        }, 150);

        onAuthStateChanged(auth, async user => {
            if(linkId) {
                renderGateway(linkId);
            } else if(user) {
                currentUser = user;
                document.getElementById('authArea').innerHTML = `<img src="${user.photoURL}" class="w-10 h-10 rounded-2xl border border-white/10 ring-4 ring-cyan-500/10 shadow-2xl">`;
                document.getElementById('omniNav').classList.remove('hidden');
                
                // Profil Hazırlık
                document.getElementById('pAvatar').src = user.photoURL;
                document.getElementById('pName').value = user.displayName;
                document.getElementById('pEmail').innerText = user.email;

                // Kullanıcı DB Kontrol
                const uRef = doc(db, "users", user.uid);
                const uSnap = await getDoc(uRef);
                if(!uSnap.exists()) {
                    await updateDoc(uRef, { name: user.displayName, avatar: user.photoURL, followers: [], following: [], stats: { views: 0, links: 0 } });
                }
                
                switchTab('discovery');
            } else {
                renderLanding();
            }
        });

        window.login = () => signInWithPopup(auth, provider);

        function renderLanding() {
            document.getElementById('view-discovery').innerHTML = `
                <div class="text-center py-20 page-transition">
                    <div class="nvo-glass-logo w-fit mx-auto mb-10 p-logo">
                        <i class="fa-solid fa-rocket nvo-rocket text-5xl"></i>
                    </div>
                    <h1 class="text-5xl font-black mb-6 leading-tight">İçeriğini Paylaş,<br><span class="text-cyan-400">Kitleni Sosyalleştir.</span></h1>
                    <p class="text-slate-500 mb-12 max-w-sm mx-auto font-medium">Reklam geçişli linklerden daha fazlası. Profilini oluştur, takipçi kazan ve trendlere gir.</p>
                    <button onclick="login()" class="px-12 py-6 saas-gradient rounded-[2.5rem] font-black text-white shadow-2xl shadow-cyan-500/30 active:scale-95 transition">GOOGLE İLE BAŞLA</button>
                </div>
            `;
        }

        // --- 2. NAVIGATION ---
        window.switchTab = (id) => {
            document.querySelectorAll('.tab-view').forEach(v => v.classList.add('hidden'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('view-' + id).classList.remove('hidden');
            document.getElementById('nav-' + id).classList.add('active');
            
            if(id === 'discovery') loadFeed();
            if(id === 'accounts') loadAccounts();
            if(id === 'profile') loadProfileData();
        };

        window.setCat = (cat, el) => {
            document.querySelectorAll('.cat-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            activeCat = cat;
            loadFeed();
        };

        // --- 3. CREATE LOGIC ---
        window.handleImage = (input) => {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    let w = img.width; if(w > 600) w = 600;
                    canvas.width = w; canvas.height = (img.height * w) / img.width;
                    canvas.getContext('2d').drawImage(img, 0, 0, w, canvas.height);
                    base64 = canvas.toDataURL('image/jpeg', 0.6);
                    document.getElementById('imgPreview').src = base64;
                    document.getElementById('imgPreview').classList.remove('hidden');
                    document.getElementById('imgUI').classList.add('hidden');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        };

        window.addStep = () => {
            const icon = document.getElementById('sIcon').value;
            tempSteps.push({ icon, type: icon, done: false });
            renderSteps();
        };

        function renderSteps() {
            document.getElementById('stepCount').innerText = tempSteps.length;
            document.getElementById('builderSteps').innerHTML = tempSteps.map((s, i) => `
                <div class="flex items-center justify-between bg-white/5 p-4 rounded-2xl border border-white/5">
                    <div class="flex items-center gap-3">
                        <i class="fa-brands fa-${s.icon === 'link' ? 'chrome' : s.icon} text-cyan-400"></i>
                        <span class="text-[10px] font-bold uppercase">${s.icon} Görevi</span>
                    </div>
                    <button onclick="tempSteps.splice(${i},1);renderSteps()" class="text-red-500/50 hover:text-red-500 transition"><i class="fa-solid fa-trash"></i></button>
                </div>
            `).join('');
        }

        window.publishCampaign = async () => {
            const title = document.getElementById('lTitle').value;
            const target = document.getElementById('lTarget').value;
            const cat = document.getElementById('lCat').value;
            
            if(!title || !target || !base64) return alert("Lütfen tüm alanları (ve resmi) doldurun!");
            
            document.getElementById('pubBtn').innerText = "YAYINLANIYOR...";
            document.getElementById('pubBtn').disabled = true;

            try {
                const docRef = await addDoc(collection(db, "links"), {
                    title, target, category: cat, image: base64, steps: tempSteps,
                    uid: currentUser.uid, uName: currentUser.displayName, uAvatar: currentUser.photoURL,
                    views: 0, likes: 0, comments: 0, createdAt: serverTimestamp()
                });
                await updateDoc(doc(db, "users", currentUser.uid), { "stats.links": increment(1) });
                location.reload();
            } catch (e) { alert("Hata oluştu!"); }
        };

        // --- 4. FEED & PROFILE DATA ---
        async function loadFeed() {
            const feed = document.getElementById('discoveryFeed');
            feed.innerHTML = `<div class="text-center py-20 text-slate-600 font-bold">Veriler Getiriliyor...</div>`;
            
            let q = query(collection(db, "links"), orderBy("createdAt", "desc"), limit(20));
            if(activeCat !== "Hepsi") q = query(collection(db, "links"), where("category", "==", activeCat), orderBy("createdAt", "desc"));
            
            const snap = await getDocs(q);
            feed.innerHTML = "";
            snap.forEach(d => {
                const data = d.data();
                feed.innerHTML += `
                    <div class="glass-card overflow-hidden group">
                        <div class="relative h-64">
                            <img src="${data.image}" class="w-full h-full object-cover group-hover:scale-105 transition duration-700">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"></div>
                            <div class="absolute bottom-6 left-6 right-6 flex justify-between items-end">
                                <div>
                                    <span class="text-[9px] font-black text-cyan-400 uppercase tracking-widest bg-black/40 backdrop-blur-md px-3 py-1 rounded-full border border-white/10 mb-2 inline-block">${data.category}</span>
                                    <h3 class="text-2xl font-black text-white leading-tight">${data.title}</h3>
                                </div>
                                <div class="text-yellow-500 text-xs flex items-center gap-1 bg-black/40 px-3 py-1 rounded-full border border-white/10">
                                    <i class="fa-solid fa-star"></i> <span>4.9</span>
                                </div>
                            </div>
                        </div>
                        <div class="p-6 flex items-center justify-between bg-white/[0.02]">
                            <div class="flex items-center gap-3">
                                <img src="${data.uAvatar}" class="w-8 h-8 rounded-full border border-white/10 shadow-lg">
                                <div>
                                    <p class="text-xs font-bold text-slate-300">${data.uName}</p>
                                    <p class="text-[9px] text-slate-500 font-black uppercase">${data.views} İzlenme</p>
                                </div>
                            </div>
                            <div class="flex gap-4">
                                <button class="text-slate-500 hover:text-red-500 transition"><i class="fa-solid fa-heart"></i></button>
                                <button onclick="location.href='?id=${d.id}'" class="bg-cyan-600/10 text-cyan-400 px-5 py-2.5 rounded-2xl text-[10px] font-black uppercase border border-cyan-500/20 hover:bg-cyan-500 hover:text-white transition">KİLİDİ AÇ</button>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        async function loadAccounts() {
            const list = document.getElementById('accountsList');
            const snap = await getDocs(query(collection(db, "users"), limit(15)));
            list.innerHTML = "";
            snap.forEach(d => {
                const data = d.data();
                if(currentUser && d.id === currentUser.uid) return;
                list.innerHTML += `
                    <div class="glass-card p-5 flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <img src="${data.avatar}" class="w-14 h-14 rounded-[1.5rem] object-cover border border-white/10">
                            <div>
                                <h4 class="font-black text-sm">${data.name}</h4>
                                <p class="text-[10px] text-slate-500 font-bold uppercase">${data.stats?.links || 0} Paylaşım • ${data.followers?.length || 0} Takipçi</p>
                            </div>
                        </div>
                        <button onclick="follow('${d.id}')" class="px-6 py-2.5 bg-white text-black rounded-2xl font-black text-[10px] active:scale-95 transition">TAKİP ET</button>
                    </div>
                `;
            });
        }

        window.follow = async (uid) => {
            await updateDoc(doc(db, "users", uid), { followers: arrayUnion(currentUser.uid) });
            await updateDoc(doc(db, "users", currentUser.uid), { following: arrayUnion(uid) });
            alert("Takip Edildi!");
        };

        async function loadProfileData() {
            const q = query(collection(db, "links"), where("uid", "==", currentUser.uid));
            const snap = await getDocs(q);
            const myLinks = document.getElementById('myLinksList');
            myLinks.innerHTML = "";
            let totalV = 0;
            document.getElementById('statLinks').innerText = snap.size;
            
            snap.forEach(d => {
                const data = d.data(); totalV += data.views;
                const link = window.location.origin + window.location.pathname + "?id=" + d.id;
                myLinks.innerHTML += `
                    <div class="glass-card p-5 flex items-center justify-between group">
                        <div class="flex items-center gap-4">
                            <img src="${data.image}" class="w-16 h-16 rounded-2xl object-cover border border-white/5">
                            <div>
                                <h4 class="font-black text-sm truncate w-32">${data.title}</h4>
                                <p class="text-[9px] text-cyan-400 font-black uppercase mt-1"><i class="fa-solid fa-eye mr-1"></i> ${data.views}</p>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="navigator.clipboard.writeText('${link}');alert('Kopyalandı!')" class="w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center text-slate-400 hover:text-cyan-400 transition"><i class="fa-solid fa-link text-xs"></i></button>
                            <button onclick="deleteDoc(doc(db, 'links', '${d.id}')).then(()=>loadProfileData())" class="w-10 h-10 rounded-xl bg-white/5 text-red-500/50 hover:bg-red-500/10 transition"><i class="fa-solid fa-trash-can text-xs"></i></button>
                        </div>
                    </div>
                `;
            });
            document.getElementById('statViews').innerText = totalV;
        }

        // --- 5. GATEWAY LOGIC ---
        async function renderGateway(id) {
            const v = document.getElementById('gatewayView');
            v.classList.remove('hidden');
            const dSnap = await getDoc(doc(db, "links", id));
            if(!dSnap.exists()) return;
            const data = dSnap.data();
            
            updateDoc(doc(db, "links", id), { views: increment(1) });

            v.innerHTML = `
                <div class="relative h-[45vh]">
                    <img src="${data.image}" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-gradient-to-t from-[#010409] via-transparent to-transparent"></div>
                    <button onclick="location.href='index.html'" class="absolute top-8 left-8 w-12 h-12 glass-card flex items-center justify-center rounded-full border border-white/20"><i class="fa-solid fa-chevron-left"></i></button>
                </div>
                
                <div class="p-8 -mt-10 bg-[#010409] rounded-t-[3.5rem] relative z-10 space-y-8 min-h-screen">
                    <div>
                        <div class="flex items-center gap-2 mb-3">
                            <span class="bg-cyan-600 text-white text-[9px] font-black px-3 py-1 rounded-full uppercase tracking-widest">NVO KORUMALI</span>
                            <span class="text-[10px] text-slate-500 font-bold uppercase"><i class="fa-solid fa-eye mr-1"></i> ${data.views + 1}</span>
                        </div>
                        <h1 class="text-4xl font-black text-white leading-tight">${data.title}</h1>
                    </div>

                    <div class="flex items-center justify-between p-5 glass-card">
                        <div class="flex items-center gap-4">
                            <img src="${data.uAvatar}" class="w-12 h-12 rounded-2xl border border-white/10">
                            <div>
                                <h4 class="font-black text-sm">${data.uName}</h4>
                                <p class="text-[10px] text-slate-500 font-bold uppercase">Yayıncı</p>
                            </div>
                        </div>
                        <button class="text-cyan-400 font-black text-xs uppercase tracking-widest">TAKİP ET</button>
                    </div>

                    <div class="space-y-4 pt-4" id="vStepsArea">
                        ${data.steps.map((s, i) => `
                            <div id="step-${i}" class="glass-card p-7 flex items-center justify-between border-l-8 ${i === 0 ? 'border-cyan-500' : 'opacity-30 pointer-events-none border-transparent'} transition-all duration-500">
                                <div class="flex items-center gap-5">
                                    <div class="w-14 h-14 rounded-2xl bg-slate-900 flex items-center justify-center text-2xl text-cyan-400">
                                        <i class="fa-brands fa-${s.icon === 'link' ? 'chrome' : s.icon}"></i>
                                    </div>
                                    <div>
                                        <p class="text-[10px] text-slate-500 font-black uppercase mb-1">Görev ${i+1}</p>
                                        <h4 class="font-black text-base uppercase tracking-tighter">${s.icon} ADIMINI TAMAMLA</h4>
                                    </div>
                                </div>
                                <button onclick="verifyStep(${i}, ${data.steps.length}, '${data.target}')" id="btn-${i}" class="bg-cyan-600 px-8 py-4 rounded-2xl font-black text-xs text-white shadow-xl ${i===0?'':'hidden'}">BAŞLAT</button>
                            </div>
                        `).join('')}
                    </div>

                    <div class="pt-10 border-t border-white/5 space-y-6">
                        <h3 class="font-black text-xl">Topluluk Yorumları</h3>
                        <div class="flex gap-3">
                            <input type="text" placeholder="Yorum yaz..." class="flex-1 bg-slate-900/50">
                            <button class="w-14 h-14 saas-gradient rounded-2xl flex items-center justify-center shadow-lg"><i class="fa-solid fa-paper-plane"></i></button>
                        </div>
                    </div>
                </div>
            `;
        }

        window.verifyStep = (i, total, target) => {
            const btn = document.getElementById('btn-' + i);
            let s = 10;
            btn.innerText = s + "s";
            const itv = setInterval(() => {
                s--; btn.innerText = s + "s";
                if(s <= 0) {
                    clearInterval(itv);
                    const stepDiv = document.getElementById('step-' + i);
                    stepDiv.classList.replace('border-cyan-500', 'border-green-500');
                    stepDiv.classList.add('bg-green-500/5');
                    btn.remove();
                    stepDiv.innerHTML += '<i class="fa-solid fa-circle-check text-green-500 text-3xl"></i>';
                    
                    if(i + 1 < total) {
                        const next = document.getElementById('step-' + (i+1));
                        next.classList.remove('opacity-30', 'pointer-events-none', 'border-transparent');
                        next.classList.add('border-cyan-500');
                        document.getElementById('btn-' + (i+1)).classList.remove('hidden');
                    } else {
                        confetti();
                        setTimeout(() => location.href = target, 1500);
                    }
                }
            }, 1000);
        };

    </script>
</body>
</html>
