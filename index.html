<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NVOLINK | ENTERPRISE SAAS</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --p: #3b82f6; --bg: #000; --card: #0c0c0e; --border: #1f1f22;
        }

        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: white; margin: 0; overflow-x: hidden; }

        /* --- LEGACY PRELOADER (O ÖZLEDİĞİN EKRAN) --- */
        #loader {
            position: fixed; inset: 0; z-index: 99999; background: #000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .loader-logo {
            width: 250px; filter: drop-shadow(0 0 30px rgba(59, 130, 246, 0.4));
            animation: pulse-logo 2s infinite ease-in-out;
        }
        .load-bar-container {
            width: 200px; height: 2px; background: #111; margin-top: 30px; border-radius: 10px; overflow: hidden;
        }
        .load-bar-fill {
            width: 0%; height: 100%; background: var(--p);
            box-shadow: 0 0 15px var(--p); animation: fill-bar 1.5s forwards;
        }
        @keyframes pulse-logo { 0%, 100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.05); opacity: 1; } }
        @keyframes fill-bar { to { width: 100%; } }

        /* --- LOGO & HEADER --- */
        .brand-logo { height: 40px; }
        
        /* --- ARAYÜZÜ BOZMAYAN KARTLAR --- */
        .titan-card {
            background: var(--card); border: 1px solid var(--border);
            border-radius: 30px; overflow: hidden; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .titan-card:hover { transform: translateY(-8px); border-color: #333; }

        .nvo-input {
            background: #0f0f11 !important; border: 1px solid var(--border) !important;
            border-radius: 20px !important; color: white !important; padding: 16px 20px !important;
            width: 100%; font-size: 14px; margin-bottom: 15px; outline: none;
        }

        /* --- NAVIGATION --- */
        .titan-nav {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 500px; height: 80px; background: rgba(12,12,14,0.9);
            backdrop-filter: blur(20px); border-radius: 40px; border: 1px solid rgba(255,255,255,0.05);
            display: flex; justify-content: space-around; align-items: center; z-index: 10000;
        }
        .nav-link { color: #444; font-size: 24px; transition: 0.4s; }
        .nav-link.active { color: var(--p); transform: translateY(-5px); }

        /* MISAFIR MODU OVERLAY */
        #guest-overlay { position: fixed; inset: 0; z-index: 80000; background: #000; display: none; overflow-y: auto; }

        .btn-titan {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white;
            font-weight: 800; border-radius: 22px; padding: 18px; width: 100%;
            border: none; cursor: pointer; text-transform: uppercase; letter-spacing: 1px;
        }
    </style>
</head>
<body class="pb-32">

    <div id="loader">
        <img src="https://i.ibb.co/p26W2R6/19124.png" alt="NVOLINK" class="loader-logo">
        <div class="load-bar-container">
            <div class="load-bar-fill"></div>
        </div>
        <p class="mt-4 text-[9px] font-black tracking-[0.5em] text-zinc-600 uppercase">Sistem Optimize Ediliyor</p>
    </div>

    <header class="p-6 flex justify-between items-center sticky top-0 bg-black/80 backdrop-blur-2xl z-[9000] border-b border-white/5">
        <img src="https://i.ibb.co/p26W2R6/19124.png" alt="NVOLINK" class="brand-logo">
        <div id="auth-zone">
            <button onclick="nv.login()" id="loginBtn" class="bg-white text-black px-6 py-2.5 rounded-2xl text-[10px] font-black uppercase">GİRİŞ YAP</button>
            <img id="h-avatar" class="hidden w-11 h-11 rounded-2xl border-2 border-blue-600 object-cover" onclick="nv.tab('profile')">
        </div>
    </header>

    <main class="max-w-xl mx-auto px-6 mt-8">
        
        <div id="v-discovery" class="view-panel space-y-8">
            <div class="titan-card p-6 bg-blue-600/5 border-blue-600/20">
                <div class="flex items-center gap-3 mb-2">
                    <i class="fa-solid fa-bell-concierge text-blue-500"></i>
                    <h4 class="text-[10px] font-black uppercase text-zinc-400">Yama Notları v0.1.2</h4>
                </div>
                <p class="text-[11px] font-bold text-zinc-500 leading-relaxed">Yeni kurumsal kimlik entegre edildi. Misafir arayüzü ve veri tamir motoru optimize edildi.</p>
            </div>

            <div class="relative">
                <i class="fa-solid fa-search absolute left-6 top-1/2 -translate-y-1/2 text-zinc-500"></i>
                <input type="text" oninput="nv.search(this.value)" placeholder="İçerik ara..." class="nvo-input pl-16 h-16 !mb-0 !rounded-[25px]">
            </div>

            <div id="feed" class="grid grid-cols-1 gap-8"></div>
        </div>

        <div id="v-create" class="view-panel hidden">
            <div class="titan-card p-8 space-y-6">
                <h2 class="text-2xl font-black italic uppercase tracking-tighter">Kampanya Paneli</h2>
                <input type="text" id="c-title" placeholder="Başlık" class="nvo-input">
                <input type="text" id="c-target" placeholder="Hedef URL" class="nvo-input">
                
                <div class="relative group cursor-pointer" onclick="document.getElementById('c-file').click()">
                    <input type="file" id="c-file" accept="image/*" class="hidden" onchange="nv.handleFile(this)">
                    <div class="w-full bg-zinc-900 border-2 border-dashed border-zinc-800 p-10 rounded-[2rem] text-center group-hover:border-blue-500 transition-all">
                        <i class="fa-solid fa-cloud-arrow-up text-2xl text-blue-500 mb-2"></i>
                        <p class="text-[9px] font-black text-zinc-500 uppercase tracking-widest">Kapak Resmi Yükle</p>
                    </div>
                    <img id="img-preview" class="w-full h-44 object-cover rounded-3xl mt-4 hidden shadow-2xl">
                </div>

                <div id="task-area" class="bg-zinc-900/40 p-6 rounded-[2rem] border border-white/5">
                    <div id="task-list" class="space-y-3 mb-4"></div>
                    <div class="flex gap-2">
                        <input type="text" id="t-name" placeholder="Görev Adı" class="nvo-input !mb-0 text-xs">
                        <input type="text" id="t-link" placeholder="Görev URL" class="nvo-input !mb-0 text-xs">
                    </div>
                    <button onclick="nv.addTask()" class="w-full bg-white text-black py-4 rounded-2xl font-black text-[10px] mt-4 uppercase">LİSTEYE EKLE</button>
                </div>

                <button id="pubBtn" onclick="nv.publish()" class="btn-titan mt-4">KAMPANYAYI BAŞLAT</button>
            </div>
        </div>

        <div id="v-profile" class="view-panel hidden">...</div>

    </main>

    <div id="guest-overlay">
        <div class="max-w-md mx-auto px-6 py-12 text-center">
            <img src="https://i.ibb.co/p26W2R6/19124.png" class="h-12 mx-auto mb-10">
            <div id="g-content" class="titan-card p-10 space-y-8">
                </div>
        </div>
    </div>

    <nav class="titan-nav">
        <button onclick="nv.tab('discovery')" class="nav-link active" id="n-discovery"><i class="fa-solid fa-house-chimney"></i></button>
        <button onclick="nv.tab('create')" class="nav-link" id="n-create"><i class="fa-solid fa-plus-circle text-4xl text-blue-500"></i></button>
        <button onclick="nv.tab('profile')" class="nav-link" id="n-profile"><i class="fa-solid fa-circle-user"></i></button>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, doc, getDoc, getDocs, updateDoc, deleteDoc, query, where, orderBy, serverTimestamp, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // ... Firebase Config (Öncekiyle aynı) ...
        const firebaseConfig = {
            apiKey: "AIzaSyDc1sWTsgQC4yqZnEKP4GutuNWcUCZGhv0",
            authDomain: "nvo-link.firebaseapp.com",
            projectId: "nvo-link",
            storageBucket: "nvo-link.firebasestorage.app",
            messagingSenderId: "256153773846",
            appId: "1:256153773846:web:6d51174db82ccccf119237"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        let user = null, currentTasks = [], base64Img = "";

        window.nv = {
            tab: (id) => {
                document.querySelectorAll('.view-panel').forEach(v => v.classList.add('hidden'));
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                document.getElementById('v-'+id).classList.remove('hidden');
                document.getElementById('n-'+id).classList.add('active');
            },
            
            // LOGO VE YÜKLEME EKRANI YÖNETİMİ
            init: () => {
                onAuthStateChanged(auth, u => {
                    const urlId = new URLSearchParams(window.location.search).get('id');
                    
                    // Loader'ı kapatma süresi (Görsel şölen için biraz bekletiyoruz)
                    setTimeout(() => {
                        const loader = document.getElementById('loader');
                        loader.style.opacity = '0';
                        setTimeout(() => loader.style.display = 'none', 800);
                    }, 2000);

                    if(urlId) { nv.renderGuest(urlId); }
                    if(u) {
                        user = u;
                        document.getElementById('loginBtn').classList.add('hidden');
                        document.getElementById('h-avatar').classList.remove('hidden');
                        document.getElementById('h-avatar').src = u.photoURL;
                        nv.tab('discovery');
                        nv.loadFeed();
                    }
                });
            },

            handleFile: (input) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let w = img.width, h = img.height, max = 800;
                        if(w > h) { if(w > max) { h *= max/w; w = max; } }
                        else { if(h > max) { w *= max/h; h = max; } }
                        canvas.width = w; canvas.height = h;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, w, h);
                        base64Img = canvas.toDataURL('image/jpeg', 0.6);
                        document.getElementById('img-preview').src = base64Img;
                        document.getElementById('img-preview').style.display = 'block';
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            },

            addTask: () => {
                const n = document.getElementById('t-name').value, l = document.getElementById('t-link').value;
                if(!n || !l) return;
                currentTasks.push({name: n, link: l});
                document.getElementById('task-list').innerHTML += `<div class="bg-zinc-900 p-4 rounded-2xl flex justify-between text-[11px] font-black uppercase"><span>${n}</span><i class="fa-solid fa-check text-blue-500"></i></div>`;
                document.getElementById('t-name').value = ""; document.getElementById('t-link').value = "";
            },

            publish: async () => {
                const title = document.getElementById('c-title').value, target = document.getElementById('c-target').value;
                if(!title || !target || !base64Img) return alert("Eksik Alan!");
                document.getElementById('pubBtn').innerText = "İŞLENİYOR...";
                await addDoc(collection(db, "links"), {
                    title, target, thumb: base64Img, tasks: currentTasks,
                    uid: user.uid, uName: user.displayName, uAvatar: user.photoURL,
                    views: 0, createdAt: serverTimestamp()
                });
                confetti(); setTimeout(() => location.reload(), 1500);
            },

            loadFeed: async () => {
                const feed = document.getElementById('feed');
                const snap = await getDocs(query(collection(db, "links"), orderBy("createdAt", "desc")));
                feed.innerHTML = "";
                snap.forEach(d => {
                    const data = d.data();
                    feed.innerHTML += `
                        <div class="titan-card">
                            <img src="${data.thumb}" class="w-full h-52 object-cover">
                            <div class="p-6">
                                <h3 class="text-xl font-black italic uppercase mb-4">${data.title}</h3>
                                <div class="flex justify-between items-center text-[10px] font-black text-zinc-500 uppercase">
                                    <span><i class="fa-solid fa-eye text-blue-500 mr-2"></i> ${data.views} İzleme</span>
                                    <span><i class="fa-solid fa-user text-zinc-700 mr-2"></i> ${data.uName}</span>
                                </div>
                                <button onclick="location.href='?id=${d.id}'" class="btn-titan py-3 text-[10px] mt-6">İÇERİĞE GİT</button>
                            </div>
                        </div>
                    `;
                });
            },

            renderGuest: async (id) => {
                const overlay = document.getElementById('guest-overlay');
                const content = document.getElementById('g-content');
                overlay.style.display = 'block';
                const snap = await getDoc(doc(db, "links", id));
                const d = snap.data();
                content.innerHTML = `
                    <img src="${d.thumb}" class="w-full h-48 object-cover rounded-[2rem]">
                    <h2 class="text-2xl font-black italic uppercase">${d.title}</h2>
                    <p class="text-[10px] font-bold text-zinc-500 uppercase">Dosyaya ulaşmak için görevleri tamamlayın</p>
                    <div class="space-y-3">
                        ${d.tasks.map((t, i) => `
                            <div class="bg-zinc-900 p-5 rounded-2xl flex justify-between items-center border border-white/5">
                                <span class="text-xs font-black uppercase">${t.name}</span>
                                <button onclick="window.open('${t.link}','_blank');this.innerText='✓';this.classList.add('bg-green-600')" class="bg-blue-600 px-6 py-2 rounded-xl text-[10px] font-black uppercase">YAP</button>
                            </div>
                        `).join('')}
                    </div>
                    <button onclick="nv.finish('${d.target}', '${id}')" class="btn-titan !bg-zinc-800">İNDİRMEK İÇİN GÖREVLERİ YAPIN</button>
                `;
            },

            finish: async (url, id) => {
                // Görev kontrol mantığı buraya eklenebilir
                confetti();
                await updateDoc(doc(db, "links", id), { views: increment(1) });
                setTimeout(() => window.location.href = url, 1000);
            }
        };

        nv.init();
    </script>
</body>
</html>

