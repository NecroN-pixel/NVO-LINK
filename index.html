
<!DOCTYPE html>
<html lang="tr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>NVOLINK G-0.1.1 | NOVA FRAMEWORK</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --p: #3b82f6; --p-soft: rgba(59, 130, 246, 0.1);
            --bg: #000000; --card: #0a0a0b; --border: #1a1a1c;
        }

        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: white; overflow-x: hidden; }

        /* --- PRELOADER --- */
        #loader {
            position: fixed; inset: 0; z-index: 99999; background: #000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .spin-outer { width: 70px; height: 70px; border: 4px solid #111; border-top-color: var(--p); border-radius: 50%; animation: spin 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* --- DESIGN SYSTEM --- */
        .nova-card { background: var(--card); border: 1px solid var(--border); border-radius: 35px; overflow: hidden; transition: 0.5s cubic-bezier(0.2, 0.8, 0.2, 1); }
        .nova-card:hover { transform: translateY(-10px); border-color: #333; box-shadow: 0 30px 60px rgba(0,0,0,0.6); }

        .nova-input {
            background: #0d0d0e !important; border: 1px solid var(--border) !important;
            border-radius: 22px !important; color: white !important; padding: 18px 24px !important;
            width: 100%; font-size: 14px; margin-bottom: 15px; outline: none; transition: 0.3s;
        }
        .nova-input:focus { border-color: var(--p) !important; box-shadow: 0 0 20px var(--p-soft); }

        /* --- GUEST MODE (MISAFIR ARAYÜZÜ) --- */
        #guest-mode { position: fixed; inset: 0; background: #000; z-index: 80000; overflow-y: auto; display: none; }
        .guest-container { max-width: 500px; margin: 0 auto; padding: 40px 20px; }
        .guest-thumb { width: 100%; height: 260px; border-radius: 40px; object-fit: cover; border: 1px solid #222; margin-bottom: 25px; }
        .task-item { 
            background: #0f0f11; border: 1px solid #1a1a1c; border-radius: 25px; padding: 20px 25px; 
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; transition: 0.3s;
        }
        .task-item.completed { border-color: #10b981; background: rgba(16, 185, 129, 0.05); }

        /* --- NAVIGATION --- */
        .nova-nav {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 500px; height: 85px; background: rgba(10,10,11,0.85);
            backdrop-filter: blur(30px); border-radius: 45px; border: 1px solid rgba(255,255,255,0.05);
            display: flex; justify-content: space-around; align-items: center; z-index: 10000;
        }
        .nav-link { color: #3d3d3f; font-size: 26px; transition: 0.4s; position: relative; }
        .nav-link.active { color: var(--p); transform: translateY(-8px); }
        .nav-link.active::after { content: ''; position: absolute; bottom: -12px; left: 50%; transform: translateX(-50%); width: 6px; height: 6px; background: var(--p); border-radius: 50%; box-shadow: 0 0 15px var(--p); }

        .btn-main { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; font-weight: 800; border-radius: 24px; padding: 20px; border: none; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s; }
        .btn-main:disabled { background: #1a1a1c; color: #444; cursor: not-allowed; }

        #img-preview { width: 100%; height: 200px; object-fit: cover; border-radius: 30px; display: none; margin-top: 15px; border: 2px dashed #333; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        .patch-card { background: linear-gradient(135deg, #0a0a0b, #111); border-radius: 30px; border: 1px solid #1a1a1c; padding: 25px; }
    </style>
</head>
<body class="pb-40">

    <div id="loader">
        <div class="spin-outer"></div>
        <p class="mt-8 font-black text-[11px] tracking-[0.6em] text-blue-500 uppercase">NOVA ARCHITECTURE G-0.1.1</p>
    </div>

    <div id="guest-mode">
        <div class="guest-container">
            <div class="text-center mb-10">
                <div class="w-16 h-16 bg-blue-600 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-2xl shadow-blue-500/30">
                    <i class="fa-solid fa-lock-open text-white text-2xl"></i>
                </div>
                <h1 id="g-title" class="text-3xl font-black italic uppercase tracking-tighter">İÇERİK KİLİTLİ</h1>
                <p class="text-[10px] text-zinc-500 font-bold uppercase mt-2 tracking-widest">Devam etmek için görevleri tamamla</p>
            </div>
            
            <img id="g-thumb" class="guest-thumb shadow-2xl">
            
            <div id="g-tasks" class="space-y-3 mb-10"></div>
            
            <button id="g-download" disabled class="btn-main w-full py-6 text-sm">DOSYAYI İNDİR</button>
            <p class="text-center text-zinc-700 text-[10px] font-black uppercase mt-8 tracking-widest">Powered by NVOLINK NOVA</p>
        </div>
    </div>

    <header class="p-6 flex justify-between items-center sticky top-0 bg-black/80 backdrop-blur-2xl z-[1000] border-b border-white/5">
        <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center shadow-xl shadow-blue-500/20"><i class="fa-solid fa-atom text-white text-xl"></i></div>
            <div class="text-2xl font-black italic tracking-tighter uppercase">NVO<span class="text-blue-500">LINK</span></div>
        </div>
        <div id="auth-box">
            <button onclick="nv.login()" id="loginBtn" class="bg-zinc-900 border border-zinc-800 px-6 py-2.5 rounded-2xl text-[10px] font-black uppercase tracking-widest">GİRİŞ</button>
            <img id="h-avatar" class="hidden w-12 h-12 rounded-2xl border-2 border-blue-600 object-cover" onclick="nv.tab('profile')">
        </div>
    </header>

    <main class="max-w-xl mx-auto px-6 mt-8">
        
        <div id="v-discovery" class="view-panel space-y-8">
            <div class="patch-card">
                <div class="flex items-center gap-3 mb-4">
                    <span class="bg-blue-600 text-[9px] font-black px-3 py-1 rounded-full">YENİ</span>
                    <h4 class="text-[11px] font-black uppercase tracking-widest text-zinc-400">Yama Notları v0.1.1</h4>
                </div>
                <ul class="text-[11px] font-bold text-zinc-500 space-y-2">
                    <li><i class="fa-solid fa-check text-blue-500 mr-2"></i> Misafirler için "Pure Gateway" modu eklendi.</li>
                    <li><i class="fa-solid fa-check text-blue-500 mr-2"></i> 500KB Resim İşleme Motoru 2.0 optimize edildi.</li>
                    <li><i class="fa-solid fa-check text-blue-500 mr-2"></i> Veritabanı koruma kalkanı aktif.</li>
                </ul>
            </div>

            <div class="relative">
                <i class="fa-solid fa-search absolute left-6 top-1/2 -translate-y-1/2 text-zinc-600"></i>
                <input type="text" oninput="nv.search(this.value)" placeholder="Başlık veya hesap:isim ara..." class="nova-input !mb-0 pl-16 h-16 !rounded-[25px]">
            </div>

            <div id="feed" class="grid grid-cols-1 gap-8"></div>
        </div>

        <div id="v-stats" class="view-panel hidden space-y-8">
            <h2 class="text-3xl font-black italic uppercase tracking-tighter">Global Analiz</h2>
            <div class="grid grid-cols-2 gap-6">
                <div class="nova-card p-10 text-center">
                    <p id="st-l" class="text-5xl font-black italic">0</p>
                    <p class="text-[10px] text-zinc-500 font-black uppercase mt-4">Toplam Link</p>
                </div>
                <div class="nova-card p-10 text-center">
                    <p id="st-v" class="text-5xl font-black italic text-blue-500">0</p>
                    <p class="text-[10px] text-zinc-500 font-black uppercase mt-4">Toplam Tık</p>
                </div>
            </div>
            <div id="st-cats" class="nova-card p-8 space-y-4"></div>
        </div>

        <div id="v-create" class="view-panel hidden space-y-6">
            <div class="nova-card p-10 space-y-6">
                <h2 class="text-2xl font-black italic uppercase">Link Konfigüratörü</h2>
                <input type="text" id="c-title" placeholder="İçerik Başlığı" class="nova-input">
                <input type="text" id="c-target" placeholder="Hedef Dosya/Site Linki" class="nova-input">
                <input type="text" id="c-cat" placeholder="Kategori (Oyun, Script vb.)" class="nova-input">

                <div class="relative">
                    <input type="file" id="c-file" accept="image/*" class="hidden" onchange="nv.handleFile(this)">
                    <button onclick="document.getElementById('c-file').click()" class="w-full bg-zinc-900 border-2 border-dashed border-zinc-800 p-12 rounded-[2.5rem] text-[10px] font-black text-zinc-500 uppercase tracking-widest hover:border-blue-500 transition-all">
                        <i class="fa-solid fa-camera-retro text-3xl mb-4 block text-blue-500"></i>
                        Kapak Görseli Seç (OTO 500KB)
                    </button>
                    <img id="img-preview" class="shadow-2xl">
                </div>

                <div class="bg-zinc-900/50 p-6 rounded-[2.5rem] border border-white/5">
                    <p class="text-[10px] font-black text-blue-500 uppercase mb-5 tracking-widest">Görev Zinciri</p>
                    <div id="task-stack" class="space-y-3 mb-6"></div>
                    <div class="space-y-3">
                        <input type="text" id="t-name" placeholder="Görev Adı" class="nova-input !mb-0 text-xs">
                        <input type="text" id="t-link" placeholder="Görev URL" class="nova-input !mb-0 text-xs">
                        <button onclick="nv.addTask()" class="w-full bg-white text-black py-4 rounded-2xl font-black text-[10px] uppercase">GÖREVİ EKLE</button>
                    </div>
                </div>

                <button id="pubBtn" onclick="nv.publish()" class="btn-main w-full py-5 text-xs">SİSTEME KAYDET VE YAYINLA</button>
            </div>
        </div>

        <div id="v-profile" class="view-panel hidden space-y-6">
            <div class="nova-card p-12 text-center">
                <img id="p-avatar" class="w-32 h-32 rounded-[3.5rem] mx-auto border-4 border-blue-600 mb-6 object-cover shadow-2xl">
                <h3 id="p-name" class="text-3xl font-black italic uppercase tracking-tighter">...</h3>
                <div class="grid grid-cols-2 gap-6 mt-10">
                    <div class="bg-zinc-900 p-8 rounded-[2.5rem] border border-white/5"><p id="ps-l" class="text-3xl font-black">0</p><p class="text-[9px] text-zinc-600 font-black uppercase mt-2">Link</p></div>
                    <div class="bg-zinc-900 p-8 rounded-[2.5rem] border border-white/5"><p id="ps-p" class="text-3xl font-black text-blue-500">0</p><p class="text-[9px] text-zinc-600 font-black uppercase mt-2">Puan</p></div>
                </div>
            </div>
            <div id="my-links" class="space-y-4 mt-8"></div>
        </div>

    </main>

    <nav class="nova-nav">
        <button onclick="nv.tab('discovery')" class="nav-link active" id="n-discovery"><i class="fa-solid fa-compass"></i></button>
        <button onclick="nv.tab('stats')" class="nav-link" id="n-stats"><i class="fa-solid fa-chart-line"></i></button>
        <button onclick="nv.tab('create')" class="nav-link" id="n-create"><i class="fa-solid fa-plus-circle text-4xl text-blue-500"></i></button>
        <button onclick="nv.tab('profile')" class="nav-link" id="n-profile"><i class="fa-solid fa-user-astronaut"></i></button>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, doc, getDoc, getDocs, updateDoc, deleteDoc, query, where, orderBy, serverTimestamp, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDc1sWTsgQC4yqZnEKP4GutuNWcUCZGhv0",
            authDomain: "nvo-link.firebaseapp.com",
            projectId: "nvo-link",
            storageBucket: "nvo-link.firebasestorage.app",
            messagingSenderId: "256153773846",
            appId: "1:256153773846:web:6d51174db82ccccf119237"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        let user = null, currentTasks = [], base64Img = "";

        window.nv = {
            login: () => signInWithPopup(auth, provider),
            
            tab: (id) => {
                document.querySelectorAll('.view-panel').forEach(v => v.classList.add('hidden'));
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                document.getElementById('v-'+id).classList.remove('hidden');
                document.getElementById('n-'+id).classList.add('active');
                if(id === 'discovery') nv.loadFeed();
                if(id === 'stats') nv.loadStats();
                if(id === 'profile') nv.loadProfile();
                window.scrollTo({top:0, behavior:'smooth'});
            },

            handleFile: (input) => {
                const file = input.files[0];
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let w = img.width, h = img.height, max = 800;
                        if(w > h) { if(w > max) { h *= max/w; w = max; } }
                        else { if(h > max) { w *= max/h; h = max; } }
                        canvas.width = w; canvas.height = h;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, w, h);
                        base64Img = canvas.toDataURL('image/jpeg', 0.6);
                        document.getElementById('img-preview').src = base64Img;
                        document.getElementById('img-preview').style.display = 'block';
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            },

            addTask: () => {
                const n = document.getElementById('t-name').value, l = document.getElementById('t-link').value;
                if(!n || !l) return;
                currentTasks.push({name: n, link: l, done: false});
                document.getElementById('t-name').value = ""; document.getElementById('t-link').value = "";
                nv.renderTaskStack();
            },

            renderTaskStack: () => {
                document.getElementById('task-stack').innerHTML = currentTasks.map((t, i) => `<div class="bg-zinc-900 p-4 rounded-2xl flex justify-between text-[11px] font-black uppercase"><span>${t.name}</span><button onclick="currentTasks.splice(${i},1);nv.renderTaskStack()" class="text-red-500/50"><i class="fa-solid fa-trash"></i></button></div>`).join('');
            },

            publish: async () => {
                const title = document.getElementById('c-title').value, target = document.getElementById('c-target').value, cat = document.getElementById('c-cat').value || "Genel";
                if(!title || !target || !base64Img || currentTasks.length === 0) return alert("Eksik veri!");
                document.getElementById('pubBtn').innerText = "SYNCHRONIZING...";
                await addDoc(collection(db, "links"), {
                    title, target, category: cat, thumb: base64Img, tasks: currentTasks,
                    uid: user.uid, uName: user.displayName, uAvatar: user.photoURL,
                    views: 0, points: currentTasks.length * 20, createdAt: serverTimestamp()
                });
                confetti(); setTimeout(() => location.reload(), 1500);
            },

            loadFeed: async () => {
                const feed = document.getElementById('feed');
                const snap = await getDocs(query(collection(db, "links"), orderBy("createdAt", "desc")));
                feed.innerHTML = "";
                snap.forEach(d => {
                    const data = d.data();
                    feed.innerHTML += `
                        <div class="nova-card">
                            <img src="${data.thumb}" class="w-full h-56 object-cover border-b border-white/5">
                            <div class="p-8">
                                <div class="flex justify-between items-start mb-6">
                                    <div><p class="text-[10px] font-black text-blue-500 uppercase tracking-widest">${data.category}</p><h3 class="text-xl font-black italic uppercase">${data.title}</h3></div>
                                    <span class="bg-zinc-900 px-4 py-2 rounded-xl text-[11px] font-black text-zinc-500">${data.points} PTS</span>
                                </div>
                                <div class="flex items-center gap-6 text-[10px] font-black text-zinc-600 uppercase mb-8">
                                    <span><i class="fa-solid fa-eye text-blue-500 mr-2"></i> ${data.views}</span>
                                    <span><i class="fa-solid fa-user-circle text-purple-500 mr-2"></i> ${data.uName}</span>
                                </div>
                                <button onclick="location.href='?id=${d.id}'" class="btn-main w-full py-4 text-[10px]">LİNKİ PAYLAŞ / AÇ</button>
                            </div>
                        </div>
                    `;
                });
            },

            // --- MISAFIR MODU MANTIGI ---
            renderGuest: async (id) => {
                document.getElementById('loader').style.display = 'flex';
                const snap = await getDoc(doc(db, "links", id));
                if(!snap.exists()) return location.href = "/";
                const data = snap.data();
                
                document.getElementById('guest-mode').style.display = 'block';
                document.getElementById('g-title').innerText = data.title;
                document.getElementById('g-thumb').src = data.thumb;
                
                const taskBox = document.getElementById('g-tasks');
                taskBox.innerHTML = data.tasks.map((t, i) => `
                    <div id="tk-${i}" class="task-item">
                        <span class="text-xs font-black uppercase tracking-tight">${t.name}</span>
                        <button onclick="nv.doTask(${i}, '${t.link}', ${data.tasks.length}, '${data.target}', '${id}')" class="bg-blue-600 px-6 py-3 rounded-2xl text-[10px] font-black uppercase">YAP</button>
                    </div>
                `).join('');
                
                setTimeout(() => document.getElementById('loader').style.display = 'none', 1000);
            },

            tasksDone: 0,
            doTask: (i, link, total, target, id) => {
                window.open(link, '_blank');
                const btn = document.querySelector(`#tk-${i} button`);
                btn.innerText = "BEKLE..."; btn.disabled = true;
                
                setTimeout(() => {
                    document.getElementById(`tk-${i}`).classList.add('completed');
                    btn.innerHTML = '<i class="fa-solid fa-check"></i>';
                    btn.classList.replace('bg-blue-600', 'bg-green-600');
                    nv.tasksDone++;
                    
                    if(nv.tasksDone === total) {
                        const dl = document.getElementById('g-download');
                        dl.disabled = false;
                        dl.onclick = async () => {
                            confetti();
                            await updateDoc(doc(db, "links", id), { views: increment(1) });
                            window.location.href = target;
                        };
                    }
                }, 6000);
            },

            loadStats: async () => {
                const snap = await getDocs(collection(db, "links"));
                let v = 0; snap.forEach(d => v += (d.data().views || 0));
                document.getElementById('st-l').innerText = snap.size;
                document.getElementById('st-v').innerText = v;
            },

            loadProfile: async () => {
                if(!user) return;
                const snap = await getDocs(query(collection(db, "links"), where("uid", "==", user.uid)));
                let p = 0; 
                document.getElementById('my-links').innerHTML = "";
                snap.forEach(d => {
                    p += (d.data().points || 0);
                    document.getElementById('my-links').innerHTML += `<div class="nova-card p-6 flex justify-between items-center bg-zinc-900/40"><span class="text-xs font-bold uppercase">${d.data().title}</span><button onclick="nv.del('${d.id}')" class="text-red-500/30"><i class="fa-solid fa-trash"></i></button></div>`;
                });
                document.getElementById('ps-l').innerText = snap.size;
                document.getElementById('ps-p').innerText = p;
            },

            del: async (id) => { if(confirm("Silinsin mi?")) { await deleteDoc(doc(db, "links", id)); nv.loadProfile(); } },
            search: async (v) => { /* Benzer arama mantığı */ }
        };

        onAuthStateChanged(auth, u => {
            const urlId = new URLSearchParams(window.location.search).get('id');
            if(urlId) return nv.renderGuest(urlId);
            
            setTimeout(() => { document.getElementById('loader').style.opacity = '0'; setTimeout(() => document.getElementById('loader').style.display='none', 800); }, 1500);
            
            if(u) {
                user = u;
                document.getElementById('loginBtn').classList.add('hidden');
                document.getElementById('h-avatar').classList.remove('hidden');
                document.getElementById('h-avatar').src = u.photoURL;
                document.getElementById('p-avatar').src = u.photoURL;
                document.getElementById('p-name').innerText = u.displayName;
                nv.tab('discovery');
            }
        });
    </script>
</body>
</html>
